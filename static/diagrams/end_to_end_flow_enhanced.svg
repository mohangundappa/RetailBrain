<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="900" height="780" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="900" height="780" fill="#222222" rx="10" ry="10"/>
  
  <!-- Title -->
  <text x="450" y="40" font-family="Arial" font-size="24" fill="#ffffff" text-anchor="middle" font-weight="bold">End-to-End Flow: From User Input to Response</text>
  <text x="450" y="70" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Enhanced architecture with fallbacks, scaling, persistence, and feedback loops</text>
  
  <!-- System Boundary -->
  <rect x="50" y="100" width="800" height="630" fill="#333333" rx="8" ry="8" stroke="#555555" stroke-width="2"/>
  
  <!-- Horizontal Lines for Visual Grouping -->
  <!-- Interface Layer -->
  <rect x="60" y="120" width="780" height="100" fill="#2c3e50" rx="5" ry="5" opacity="0.2"/>
  <text x="110" y="135" font-family="Arial" font-size="12" fill="#ffffff">Interface Layer</text>
  
  <!-- Orchestration Layer -->
  <rect x="60" y="230" width="780" height="100" fill="#8e44ad" rx="5" ry="5" opacity="0.2"/>
  <text x="110" y="245" font-family="Arial" font-size="12" fill="#ffffff">Orchestration Layer</text>
  
  <!-- Processing Layer -->
  <rect x="60" y="340" width="780" height="220" fill="#2980b9" rx="5" ry="5" opacity="0.2"/>
  <text x="110" y="355" font-family="Arial" font-size="12" fill="#ffffff">Processing Layer</text>
  
  <!-- Data Layer -->
  <rect x="60" y="570" width="780" height="100" fill="#16a085" rx="5" ry="5" opacity="0.2"/>
  <text x="110" y="585" font-family="Arial" font-size="12" fill="#ffffff">Data Layer</text>
  
  <!-- User Input Section -->
  <rect x="70" y="130" width="180" height="80" fill="#3498db" rx="5" ry="5" stroke="#5dade2" stroke-width="2"/>
  <text x="160" y="165" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">User Input</text>
  <text x="160" y="190" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Multiple channels</text>
  
  <!-- Frontend Integration -->
  <rect x="320" y="130" width="180" height="80" fill="#3498db" rx="5" ry="5" stroke="#5dade2" stroke-width="2"/>
  <text x="410" y="165" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Frontend Integration</text>
  <text x="410" y="190" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Kore.ai, Slack, Web</text>
  
  <!-- API Gateway -->
  <rect x="570" y="130" width="180" height="80" fill="#3498db" rx="5" ry="5" stroke="#5dade2" stroke-width="2"/>
  <text x="660" y="155" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">API Gateway</text>
  <text x="660" y="180" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Request handling</text>
  <text x="660" y="200" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle" font-style="italic">[Horizontally scaled]</text>
  
  <!-- Brain Orchestrator -->
  <rect x="320" y="240" width="180" height="80" fill="#8e44ad" rx="5" ry="5" stroke="#a569bd" stroke-width="2"/>
  <text x="410" y="265" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Brain Orchestrator</text>
  <text x="410" y="290" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Intent detection, routing</text>
  <text x="410" y="310" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle" font-style="italic">[Horizontally scaled]</text>
  
  <!-- Security & Compliance -->
  <rect x="70" y="240" width="180" height="80" fill="#7d3c98" rx="5" ry="5" stroke="#d2b4de" stroke-width="2"/>
  <text x="160" y="275" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Security Layer</text>
  <text x="160" y="300" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Authentication, validation</text>
  
  <!-- Telemetry System -->
  <rect x="570" y="240" width="180" height="80" fill="#7d3c98" rx="5" ry="5" stroke="#d2b4de" stroke-width="2"/>
  <text x="660" y="275" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Telemetry System</text>
  <text x="660" y="300" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Logging, metrics, tracing</text>
  
  <!-- Agent Selection -->
  <rect x="320" y="350" width="180" height="80" fill="#2980b9" rx="5" ry="5" stroke="#3498db" stroke-width="2"/>
  <text x="410" y="375" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Agent Selection</text>
  <text x="410" y="400" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Dynamic agent assignment</text>
  
  <!-- Analytics & Feedback -->
  <rect x="70" y="350" width="180" height="80" fill="#e67e22" rx="5" ry="5" stroke="#f39c12" stroke-width="2"/>
  <text x="160" y="375" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Analytics System</text>
  <text x="160" y="400" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Learning & Improvement</text>
  
  <!-- LLM Foundation -->
  <rect x="70" y="460" width="180" height="80" fill="#6c3483" rx="5" ry="5" stroke="#9b59b6" stroke-width="2"/>
  <text x="160" y="485" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">LLM Foundation</text>
  <text x="160" y="510" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">GPT-4o, reasoning</text>
  <text x="160" y="530" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle" font-style="italic">[Horizontally scaled]</text>
  
  <!-- Specialized Agent -->
  <rect x="320" y="460" width="180" height="80" fill="#2980b9" rx="5" ry="5" stroke="#3498db" stroke-width="2"/>
  <text x="410" y="485" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Specialized Agent</text>
  <text x="410" y="510" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Agent-specific processing</text>
  
  <!-- External APIs & Tools -->
  <rect x="320" y="580" width="180" height="80" fill="#e74c3c" rx="5" ry="5" stroke="#f1c40f" stroke-width="2"/>
  <text x="410" y="605" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">External APIs</text>
  <text x="410" y="630" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Salesforce, order systems</text>
  
  <!-- Database System -->
  <rect x="570" y="460" width="180" height="80" fill="#16a085" rx="5" ry="5" stroke="#27ae60" stroke-width="2"/>
  <text x="660" y="485" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Database System</text>
  <text x="660" y="510" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">State, history, templates</text>
  <text x="660" y="530" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle" font-style="italic">[Data persistence]</text>
  
  <!-- Response Generation -->
  <rect x="70" y="580" width="180" height="80" fill="#2980b9" rx="5" ry="5" stroke="#3498db" stroke-width="2"/>
  <text x="160" y="605" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Response Generation</text>
  <text x="160" y="630" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Formatting, personalization</text>
  
  <!-- Caching System -->
  <rect x="570" y="580" width="180" height="80" fill="#16a085" rx="5" ry="5" stroke="#27ae60" stroke-width="2"/>
  <text x="660" y="605" font-family="Arial" font-size="18" fill="#ffffff" text-anchor="middle">Caching System</text>
  <text x="660" y="630" font-family="Arial" font-size="14" fill="#aaaaaa" text-anchor="middle">Response optimization</text>
  
  <!-- Connections -->
  <!-- User Input to Frontend -->
  <path d="M 250 170 L 320 170" stroke="#5dade2" stroke-width="2" fill="none"/>
  <circle cx="285" cy="170" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="285" y="174" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">1</text>
  
  <!-- Frontend to API Gateway -->
  <path d="M 500 170 L 570 170" stroke="#5dade2" stroke-width="2" fill="none"/>
  <circle cx="535" cy="170" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="535" y="174" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">2</text>
  
  <!-- API Gateway to Brain Orchestrator -->
  <path d="M 660 210 L 660 225 L 410 225 L 410 240" stroke="#5dade2" stroke-width="2" fill="none"/>
  <circle cx="535" cy="225" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="535" y="229" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">3</text>
  
  <!-- API Gateway to Security Layer -->
  <path d="M 570 170 L 535 170 L 535 225 L 160 225 L 160 240" stroke="#d2b4de" stroke-width="2" fill="none"/>
  <circle cx="160" cy="225" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="160" y="229" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">4</text>
  
  <!-- API Gateway to Telemetry -->
  <path d="M 660 210 L 660 240" stroke="#d2b4de" stroke-width="2" fill="none"/>
  <circle cx="660" cy="225" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="660" y="229" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">5</text>
  
  <!-- Security to Brain Orchestrator -->
  <path d="M 250 280 L 320 280" stroke="#d2b4de" stroke-width="2" fill="none"/>
  <circle cx="285" cy="280" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="285" y="284" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">6</text>
  
  <!-- Brain Orchestrator to Telemetry -->
  <path d="M 500 280 L 570 280" stroke="#a569bd" stroke-width="2" fill="none"/>
  <circle cx="535" cy="280" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="535" y="284" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">7</text>
  
  <!-- Brain Orchestrator to Agent Selection -->
  <path d="M 410 320 L 410 350" stroke="#a569bd" stroke-width="2" fill="none"/>
  <circle cx="410" cy="335" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="410" y="339" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">8</text>
  
  <!-- Agent Selection to Analytics -->
  <path d="M 320 390 L 250 390" stroke="#3498db" stroke-width="2" fill="none"/>
  <circle cx="285" cy="390" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="285" y="394" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">9</text>
  
  <!-- Agent Selection to Specialized Agent -->
  <path d="M 410 430 L 410 460" stroke="#3498db" stroke-width="2" fill="none"/>
  <circle cx="410" cy="445" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="410" y="449" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">10</text>
  
  <!-- Agent Selection to LLM Foundation -->
  <path d="M 320 390 L 285 390 L 285 445 L 195 445 L 195 460" stroke="#3498db" stroke-width="2" fill="none"/>
  <circle cx="195" cy="445" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="195" y="449" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">11</text>
  
  <!-- Agent Selection to Database -->
  <path d="M 500 390 L 535 390 L 535 445 L 615 445 L 615 460" stroke="#3498db" stroke-width="2" fill="none"/>
  <circle cx="535" cy="445" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="535" y="449" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">12</text>
  
  <!-- LLM to Specialized Agent -->
  <path d="M 250 500 L 320 500" stroke="#9b59b6" stroke-width="2" fill="none"/>
  <circle cx="285" cy="500" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="285" y="504" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">13</text>
  
  <!-- Specialized Agent to Database -->
  <path d="M 500 500 L 570 500" stroke="#3498db" stroke-width="2" fill="none"/>
  <circle cx="535" cy="500" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="535" y="504" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">14</text>
  <text x="535" cy="515" font-family="Arial" font-size="10" fill="#ffffff" text-anchor="middle" font-style="italic">[Persistent]</text>
  
  <!-- Specialized Agent to External APIs -->
  <path d="M 410 540 L 410 580" stroke="#3498db" stroke-width="2" fill="none"/>
  <circle cx="410" cy="560" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="410" y="564" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">15</text>
  
  <!-- External APIs to Response -->
  <path d="M 320 620 L 250 620" stroke="#f1c40f" stroke-width="2" fill="none"/>
  <circle cx="285" cy="620" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="285" y="624" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">16</text>
  
  <!-- External APIs to Caching -->
  <path d="M 500 620 L 570 620" stroke="#f1c40f" stroke-width="2" fill="none"/>
  <circle cx="535" cy="620" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="535" y="624" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">17</text>
  
  <!-- Database to Caching -->
  <path d="M 660 540 L 660 580" stroke="#27ae60" stroke-width="2" fill="none"/>
  <circle cx="660" cy="560" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="660" y="564" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">18</text>
  
  <!-- Caching to Response -->
  <path d="M 570 620 L 470 620 L 470 660 L 160 660 L 160 660" stroke="#27ae60" stroke-width="2" fill="none"/>
  <circle cx="350" cy="660" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="350" y="664" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">19</text>
  
  <!-- LLM to Response -->
  <path d="M 160 540 L 160 580" stroke="#9b59b6" stroke-width="2" fill="none"/>
  <circle cx="160" cy="560" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="160" y="564" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">20</text>
  
  <!-- Response back to User (loop) -->
  <path d="M 70 620 L 40 620 L 40 170 L 70 170" stroke="#3498db" stroke-width="2" fill="none"/>
  <circle cx="40" cy="400" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="40" y="404" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">22</text>
  
  <!-- Analytics to LLM (feedback loop) -->
  <path d="M 160 430 L 160 460" stroke="#f39c12" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  <circle cx="160" cy="445" r="12" fill="#444444" stroke="#ffffff" stroke-width="1"/>
  <text x="160" y="449" font-family="Arial" font-size="12" fill="#ffffff" text-anchor="middle">21</text>
  
  <!-- Fallback Paths -->
  <!-- LLM Fallback -->
  <path d="M 250 500 L 300 500 L 300 560 L 160 560" stroke="#e74c3c" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  <text x="210" cy="560" font-family="Arial" font-size="10" fill="#e74c3c" text-anchor="middle" font-style="italic">[Fallback]</text>
  
  <!-- External API Fallback -->
  <path d="M 500 620 L 535 620 L 535 660 L 160 660" stroke="#e74c3c" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  <text x="480" cy="660" font-family="Arial" font-size="10" fill="#e74c3c" text-anchor="middle" font-style="italic">[Fallback]</text>
  
  <!-- Asynchronous Indicators -->
  <rect x="510" y="385" width="80" height="20" fill="#e67e22" rx="10" ry="10"/>
  <text x="550" y="399" font-family="Arial" font-size="10" fill="#ffffff" text-anchor="middle">Async</text>
  
  <rect x="510" y="495" width="80" height="20" fill="#e67e22" rx="10" ry="10"/>
  <text x="550" y="509" font-family="Arial" font-size="10" fill="#ffffff" text-anchor="middle">Async</text>
  
  <rect x="510" y="615" width="80" height="20" fill="#e67e22" rx="10" ry="10"/>
  <text x="550" y="629" font-family="Arial" font-size="10" fill="#ffffff" text-anchor="middle">Async</text>
  
  <!-- Legend -->
  <rect x="110" y="700" width="20" height="10" fill="#3498db" rx="2" ry="2"/>
  <text x="135" y="709" font-family="Arial" font-size="12" fill="#ffffff">Interface</text>
  
  <rect x="220" y="700" width="20" height="10" fill="#8e44ad" rx="2" ry="2"/>
  <text x="245" y="709" font-family="Arial" font-size="12" fill="#ffffff">Orchestration</text>
  
  <rect x="330" y="700" width="20" height="10" fill="#7d3c98" rx="2" ry="2"/>
  <text x="355" y="709" font-family="Arial" font-size="12" fill="#ffffff">Security/Telemetry</text>
  
  <rect x="440" y="700" width="20" height="10" fill="#6c3483" rx="2" ry="2"/>
  <text x="465" y="709" font-family="Arial" font-size="12" fill="#ffffff">LLM</text>
  
  <rect x="550" y="700" width="20" height="10" fill="#16a085" rx="2" ry="2"/>
  <text x="575" y="709" font-family="Arial" font-size="12" fill="#ffffff">Data Storage</text>
  
  <rect x="660" y="700" width="20" height="10" fill="#e74c3c" rx="2" ry="2"/>
  <text x="685" y="709" font-family="Arial" font-size="12" fill="#ffffff">External Systems</text>
  
  <rect x="770" y="700" width="20" height="10" fill="#2980b9" rx="2" ry="2"/>
  <text x="795" y="709" font-family="Arial" font-size="12" fill="#ffffff">Agents</text>
  
  <rect x="110" y="730" width="20" height="10" fill="#e67e22" rx="2" ry="2"/>
  <text x="135" y="739" font-family="Arial" font-size="12" fill="#ffffff">Analytics</text>
  
  <path d="M 220 735 L 260 735" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,3" fill="none"/>
  <text x="285" y="739" font-family="Arial" font-size="12" fill="#ffffff">Fallback Path</text>
  
  <rect x="330" y="730" width="60" height="20" fill="#e67e22" rx="10" ry="10"/>
  <text x="360" y="744" font-family="Arial" font-size="10" fill="#ffffff" text-anchor="middle">Async</text>
  <text x="420" y="739" font-family="Arial" font-size="12" fill="#ffffff">Asynchronous</text>
  
  <text x="550" y="739" font-family="Arial" font-size="12" fill="#ffffff" font-style="italic">[Horizontally scaled]</text>
  <text x="680" y="739" font-family="Arial" font-size="12" fill="#ffffff">Horizontal Scaling</text>
</svg>