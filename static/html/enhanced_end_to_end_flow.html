<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced End-to-End Flow</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #222222;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .diagram-title {
            text-align: center;
            margin-bottom: 30px;
        }
        .system-container {
            border: 2px solid #555;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            background-color: #333;
        }
        .layer {
            padding: 15px 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .interface-layer {
            background-color: rgba(44, 62, 80, 0.3);
        }
        .orchestration-layer {
            background-color: rgba(142, 68, 173, 0.3);
        }
        .processing-layer {
            background-color: rgba(41, 128, 185, 0.3);
        }
        .data-layer {
            background-color: rgba(22, 160, 133, 0.3);
        }
        .component-row {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .component {
            border: 2px solid;
            border-radius: 5px;
            padding: 10px;
            margin: 5px;
            width: 200px;
            text-align: center;
            position: relative;
        }
        .interface {
            background-color: #3498db;
            border-color: #5dade2;
        }
        .orchestration {
            background-color: #8e44ad;
            border-color: #a569bd;
        }
        .security {
            background-color: #7d3c98;
            border-color: #d2b4de;
        }
        .agent {
            background-color: #2980b9;
            border-color: #3498db;
        }
        .llm {
            background-color: #6c3483;
            border-color: #9b59b6;
        }
        .data {
            background-color: #16a085;
            border-color: #27ae60;
        }
        .external {
            background-color: #e74c3c;
            border-color: #f1c40f;
        }
        .analytics {
            background-color: #e67e22;
            border-color: #f39c12;
        }
        .component-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        .component-subtitle {
            font-size: 12px;
            color: #aaa;
        }
        .connection {
            margin: 5px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .arrow {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            border-radius: 50%;
            background-color: #444;
            color: white;
            border: 1px solid white;
            margin: 0 5px;
        }
        .arrow-description {
            font-size: 12px;
            color: #ddd;
        }
        .fallback {
            color: #e74c3c;
            border: 1px dashed #e74c3c;
            padding: 5px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 12px;
        }
        .scaling-indicator {
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-style: italic;
            font-size: 10px;
            color: #ffffff;
        }
        .persistence-indicator {
            position: absolute;
            bottom: 5px;
            left: 10px;
            font-style: italic;
            font-size: 10px;
            color: #27ae60;
        }
        .async-indicator {
            background-color: #e67e22;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            display: inline-block;
            margin-left: 5px;
        }
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 15px;
        }
        .legend-color {
            width: 20px;
            height: 10px;
            margin-right: 5px;
            border-radius: 2px;
        }
        .legend-text {
            font-size: 12px;
        }
        .dashed-line {
            width: 40px;
            height: 1px;
            border-top: 2px dashed #e74c3c;
            margin-right: 5px;
        }
        .layer-title {
            font-size: 14px;
            margin: 0 0 10px 0;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="diagram-title">
        <h1>Enhanced End-to-End Flow: From User Input to Response</h1>
        <p>Architecture with fallbacks, scaling, persistence, and feedback loops</p>
    </div>

    <div class="system-container">
        <!-- Interface Layer -->
        <div class="layer interface-layer">
            <h3 class="layer-title">Interface Layer</h3>
            <div class="component-row">
                <div class="component interface">
                    <div class="component-title">User Input</div>
                    <div class="component-subtitle">Multiple channels</div>
                </div>
                <div class="component interface">
                    <div class="component-title">Frontend Integration</div>
                    <div class="component-subtitle">Kore.ai, Slack, Web</div>
                </div>
                <div class="component interface">
                    <div class="component-title">API Gateway</div>
                    <div class="component-subtitle">Request handling</div>
                    <div class="scaling-indicator">[Horizontally scaled]</div>
                </div>
            </div>
        </div>

        <!-- Connection 1-2 -->
        <div class="connection">
            <div class="arrow">1</div>
            <div class="arrow-description">User Input → Frontend</div>
        </div>

        <!-- Connection 2-3 -->
        <div class="connection">
            <div class="arrow">2</div>
            <div class="arrow-description">Frontend → API Gateway</div>
        </div>

        <!-- Orchestration Layer -->
        <div class="layer orchestration-layer">
            <h3 class="layer-title">Orchestration Layer</h3>
            <div class="component-row">
                <div class="component security">
                    <div class="component-title">Security Layer</div>
                    <div class="component-subtitle">Authentication, validation</div>
                </div>
                <div class="component orchestration">
                    <div class="component-title">Brain Orchestrator</div>
                    <div class="component-subtitle">Intent detection, routing</div>
                    <div class="scaling-indicator">[Horizontally scaled]</div>
                </div>
                <div class="component security">
                    <div class="component-title">Telemetry System</div>
                    <div class="component-subtitle">Logging, metrics, tracing</div>
                </div>
            </div>
        </div>

        <!-- Connection 3-6 -->
        <div class="connection">
            <div class="arrow">3</div>
            <div class="arrow-description">API Gateway → Brain Orchestrator</div>
            <div class="arrow">4</div>
            <div class="arrow-description">API Gateway → Security</div>
            <div class="arrow">5</div>
            <div class="arrow-description">API Gateway → Telemetry</div>
        </div>

        <!-- Connection 6-8 -->
        <div class="connection">
            <div class="arrow">6</div>
            <div class="arrow-description">Security → Brain</div>
            <div class="arrow">7</div>
            <div class="arrow-description">Brain → Telemetry</div>
        </div>

        <!-- Processing Layer -->
        <div class="layer processing-layer">
            <h3 class="layer-title">Processing Layer</h3>
            <div class="component-row">
                <div class="component analytics">
                    <div class="component-title">Analytics System</div>
                    <div class="component-subtitle">Learning & Improvement</div>
                </div>
                <div class="component agent">
                    <div class="component-title">Agent Selection</div>
                    <div class="component-subtitle">Dynamic agent assignment</div>
                </div>
            </div>

            <!-- Connection 8-10 -->
            <div class="connection">
                <div class="arrow">8</div>
                <div class="arrow-description">Brain → Agent Selection</div>
            </div>

            <!-- Connection 9-11 -->
            <div class="connection">
                <div class="arrow">9</div>
                <div class="arrow-description">Agent Selection → Analytics</div>
                <div class="async-indicator">Async</div>
            </div>

            <div class="component-row">
                <div class="component llm">
                    <div class="component-title">LLM Foundation</div>
                    <div class="component-subtitle">GPT-4o, reasoning</div>
                    <div class="scaling-indicator">[Horizontally scaled]</div>
                </div>
                <div class="component agent">
                    <div class="component-title">Specialized Agent</div>
                    <div class="component-subtitle">Agent-specific processing</div>
                </div>
                <div class="component data">
                    <div class="component-title">Database System</div>
                    <div class="component-subtitle">State, history, templates</div>
                    <div class="persistence-indicator">[Persistent]</div>
                </div>
            </div>
        </div>

        <!-- Connection 10-13 -->
        <div class="connection">
            <div class="arrow">10</div>
            <div class="arrow-description">Agent Selection → Specialized Agent</div>
            <div class="arrow">11</div>
            <div class="arrow-description">Agent Selection → LLM</div>
            <div class="arrow">12</div>
            <div class="arrow-description">Agent Selection → Database</div>
            <div class="async-indicator">Async</div>
        </div>

        <!-- Connection 13-15 -->
        <div class="connection">
            <div class="arrow">13</div>
            <div class="arrow-description">LLM → Specialized Agent</div>
            <div class="arrow">14</div>
            <div class="arrow-description">Specialized Agent → Database</div>
            <div class="async-indicator">Async</div>
        </div>

        <!-- Fallback Path -->
        <div class="fallback">
            LLM Fallback: Direct path to Response Generation if agent processing fails
        </div>

        <!-- Data Layer -->
        <div class="layer data-layer">
            <h3 class="layer-title">Data Layer</h3>
            <div class="component-row">
                <div class="component agent">
                    <div class="component-title">Response Generation</div>
                    <div class="component-subtitle">Formatting, personalization</div>
                </div>
                <div class="component external">
                    <div class="component-title">External APIs</div>
                    <div class="component-subtitle">Salesforce, order systems</div>
                </div>
                <div class="component data">
                    <div class="component-title">Caching System</div>
                    <div class="component-subtitle">Response optimization</div>
                </div>
            </div>
        </div>

        <!-- Connection 15-19 -->
        <div class="connection">
            <div class="arrow">15</div>
            <div class="arrow-description">Specialized Agent → External APIs</div>
            <div class="async-indicator">Async</div>
        </div>

        <!-- Connection 16-20 -->
        <div class="connection">
            <div class="arrow">16</div>
            <div class="arrow-description">External APIs → Response</div>
            <div class="arrow">17</div>
            <div class="arrow-description">External APIs → Caching</div>
            <div class="arrow">18</div>
            <div class="arrow-description">Database → Caching</div>
        </div>

        <!-- Fallback Path -->
        <div class="fallback">
            External API Fallback: Cached or default responses when API calls fail
        </div>

        <!-- Final Connections -->
        <div class="connection">
            <div class="arrow">19</div>
            <div class="arrow-description">Caching → Response</div>
            <div class="arrow">20</div>
            <div class="arrow-description">LLM → Response</div>
        </div>

        <!-- Feedback Loop -->
        <div class="connection">
            <div class="arrow">21</div>
            <div class="arrow-description">Analytics → LLM (Feedback Loop)</div>
        </div>

        <!-- Response Back to User -->
        <div class="connection">
            <div class="arrow">22</div>
            <div class="arrow-description">Response back to User (completing the loop)</div>
        </div>
    </div>

    <!-- Legend -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #3498db;"></div>
            <div class="legend-text">Interface</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #8e44ad;"></div>
            <div class="legend-text">Orchestration</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #7d3c98;"></div>
            <div class="legend-text">Security/Telemetry</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #6c3483;"></div>
            <div class="legend-text">LLM</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #16a085;"></div>
            <div class="legend-text">Data Storage</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #e74c3c;"></div>
            <div class="legend-text">External Systems</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #2980b9;"></div>
            <div class="legend-text">Agents</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #e67e22;"></div>
            <div class="legend-text">Analytics</div>
        </div>
        <div class="legend-item">
            <div class="dashed-line"></div>
            <div class="legend-text">Fallback Path</div>
        </div>
        <div class="legend-item">
            <div class="async-indicator">Async</div>
            <div class="legend-text">Asynchronous Processing</div>
        </div>
        <div class="legend-item">
            <div class="legend-text">[Horizontally scaled]</div>
            <div class="legend-text">Horizontal Scaling</div>
        </div>
        <div class="legend-item">
            <div class="legend-text">[Persistent]</div>
            <div class="legend-text">Data Persistence</div>
        </div>
    </div>
</body>
</html>