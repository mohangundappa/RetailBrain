{% extends "base.html" %}

{% block title %}Staples Brain Setup Guide{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row mb-5">
    <div class="col-lg-8 offset-lg-2">
      <h1 class="mb-4">Staples Brain: Local Setup Guide</h1>
      <p class="lead text-muted">Complete instructions for setting up Staples Brain on your local environment</p>
    </div>
  </div>

  <!-- Table of Contents -->
  <div class="row mb-5">
    <div class="col-lg-8 offset-lg-2">
      <div class="card bg-light">
        <div class="card-body">
          <h5 class="card-title">Setup Guide Contents</h5>
          <ul class="list-unstyled">
            <li><a href="#prerequisites" class="text-decoration-none">1. Prerequisites</a></li>
            <li><a href="#code-download" class="text-decoration-none">2. Code Download</a></li>
            <li><a href="#environment-setup" class="text-decoration-none">3. Environment Setup</a></li>
            <li><a href="#database-configuration" class="text-decoration-none">4. Database Configuration</a></li>
            <li><a href="#api-keys" class="text-decoration-none">5. API Keys Configuration</a></li>
            <li><a href="#running-app" class="text-decoration-none">6. Running the Application</a></li>
            <li><a href="#troubleshooting" class="text-decoration-none">7. Troubleshooting</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Prerequisites Section -->
  <div class="row mb-5" id="prerequisites">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">1. Prerequisites</h2>
      
      <div class="mt-4">
        <p>Before setting up Staples Brain locally, ensure you have the following installed:</p>
        
        <div class="card mb-4 border-0 bg-light">
          <div class="card-body">
            <h5 class="text-primary"><i class="bi bi-check-circle"></i> Required Software</h5>
            <ul>
              <li><strong>Python 3.9+</strong> - The application is built with Python</li>
              <li><strong>PostgreSQL 13+</strong> - For database storage</li>
              <li><strong>Git</strong> - For cloning the repository</li>
              <li><strong>pip</strong> - Python package manager</li>
            </ul>
          </div>
        </div>
        
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i> If you don't have PostgreSQL installed, you can download it from <a href="https://www.postgresql.org/download/" target="_blank">postgresql.org</a> or use a Docker container.
        </div>
      </div>
    </div>
  </div>

  <!-- Code Download Section -->
  <div class="row mb-5" id="code-download">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">2. Code Download</h2>
      
      <div class="mt-4">
        <p>Clone the repository to your local machine using Git:</p>
        
        <div class="card mb-4">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Terminal</h5>
          </div>
          <div class="card-body bg-dark text-white">
            <pre class="mb-0"><code>git clone https://github.com/your-username/staples-brain.git
cd staples-brain</code></pre>
          </div>
        </div>
        
        <p>Alternatively, if you've downloaded the code as a ZIP file from the Replit environment:</p>
        <ol>
          <li>Extract the ZIP file to your preferred location</li>
          <li>Open a terminal/command prompt</li>
          <li>Navigate to the extracted directory using <code>cd path/to/extracted/staples-brain</code></li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Environment Setup Section -->
  <div class="row mb-5" id="environment-setup">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">3. Environment Setup</h2>
      
      <div class="mt-4">
        <p>Set up a Python virtual environment and install the required dependencies:</p>
        
        <div class="card mb-4">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Terminal</h5>
          </div>
          <div class="card-body bg-dark text-white">
            <pre class="mb-0"><code># Create a virtual environment
python -m venv venv

# Activate the virtual environment
# On Windows:
venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate

# Install dependencies
pip install -r requirements-local.txt</code></pre>
          </div>
        </div>
        
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i> We've provided a <code>requirements-local.txt</code> file in the repository that contains all the necessary dependencies with specific versions. If you don't have this file, you can <a href="/api/download/requirements-local.txt" download="requirements-local.txt" class="alert-link">download it here</a>.
        </div>
        
        <div class="card mb-4">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">requirements-local.txt</h5>
          </div>
          <div class="card-body bg-dark text-white">
            <pre class="mb-0"><code># Core dependencies
flask==2.3.3
flask-cors==4.0.0
flask-sqlalchemy==3.1.1
flask-login==0.6.2
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
gunicorn==21.2.0
email-validator==2.1.0.post1

# LangChain and AI dependencies
langchain==0.0.335
langchain-core==0.1.8
langchain-community==0.0.16
langchain-openai==0.0.5
langsmith==0.0.78
openai==1.3.7

# And other dependencies... (download the complete file)</code></pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Database Configuration Section -->
  <div class="row mb-5" id="database-configuration">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">4. Database Configuration</h2>
      
      <div class="mt-4">
        <p>Configure your PostgreSQL database for Staples Brain:</p>
        
        <div class="card mb-4 border-0 bg-light">
          <div class="card-body">
            <h5 class="text-primary"><i class="bi bi-database"></i> Basic Database Setup</h5>
            <ol>
              <li><strong>Create a PostgreSQL database:</strong>
                <div class="card mb-3 mt-2">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">PostgreSQL Command Line</h6>
                  </div>
                  <div class="card-body bg-dark text-white">
                    <pre class="mb-0"><code># Login to PostgreSQL
psql -U postgres

# Create a database
CREATE DATABASE staples_brain;

# Create a user (optional, you can use the postgres user)
CREATE USER staples_user WITH PASSWORD 'your_secure_password';

# Grant privileges
GRANT ALL PRIVILEGES ON DATABASE staples_brain TO staples_user;

# Connect to the new database
\c staples_brain

# Grant schema privileges to the user
GRANT ALL ON SCHEMA public TO staples_user;

# Exit PostgreSQL
\q</code></pre>
                  </div>
                </div>
              </li>
              <li><strong>Create a .env file:</strong> In the root directory of the project, create a <code>.env</code> file with your database connection information:
                <div class="card mb-3 mt-2">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">.env</h6>
                  </div>
                  <div class="card-body bg-dark text-white">
                    <pre class="mb-0"><code>DATABASE_URL=postgresql://staples_user:your_secure_password@localhost/staples_brain
PGUSER=staples_user
PGPASSWORD=your_secure_password
PGHOST=localhost
PGDATABASE=staples_brain
PGPORT=5432
SESSION_SECRET=your_secret_key_for_flask_sessions</code></pre>
                  </div>
                </div>
              </li>
            </ol>
          </div>
        </div>
        
        <div class="alert alert-info mb-4">
          <i class="bi bi-info-circle"></i> <strong>About Database Tables:</strong> The Staples Brain application automatically creates all required tables on startup using SQLAlchemy ORM. You don't need to create tables manually.
        </div>

        <div class="accordion mb-4" id="databaseAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingDbSchema">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDbSchema" aria-expanded="false" aria-controls="collapseDbSchema">
                <strong>Database Schema Overview</strong>
              </button>
            </h2>
            <div id="collapseDbSchema" class="accordion-collapse collapse" aria-labelledby="headingDbSchema" data-bs-parent="#databaseAccordion">
              <div class="accordion-body">
                <p>The Staples Brain database uses the following main tables:</p>
                <table class="table table-sm table-striped">
                  <thead>
                    <tr>
                      <th>Table Name</th>
                      <th>Description</th>
                      <th>Key Columns</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><code>conversation</code></td>
                      <td>Stores conversation records between users and agents</td>
                      <td>id, session_id, user_input, brain_response, intent, confidence</td>
                    </tr>
                    <tr>
                      <td><code>message</code></td>
                      <td>Individual messages in a conversation</td>
                      <td>id, conversation_id, role, content, created_at</td>
                    </tr>
                    <tr>
                      <td><code>package_tracking</code></td>
                      <td>Tracking information from the Package Tracking agent</td>
                      <td>id, conversation_id, tracking_number, shipping_carrier, order_number, status</td>
                    </tr>
                    <tr>
                      <td><code>password_reset</code></td>
                      <td>Reset password request information</td>
                      <td>id, conversation_id, email, username, account_type, issue</td>
                    </tr>
                    <tr>
                      <td><code>store_locator</code></td>
                      <td>Store location search data</td>
                      <td>id, conversation_id, location, radius, service, store_id, store_name</td>
                    </tr>
                    <tr>
                      <td><code>product_info</code></td>
                      <td>Product information lookup data</td>
                      <td>id, conversation_id, product_name, product_id, category, price</td>
                    </tr>
                    <tr>
                      <td><code>custom_agent</code></td>
                      <td>Configuration for user-created agents</td>
                      <td>id, name, description, created_at, updated_at, is_active, configuration</td>
                    </tr>
                    <tr>
                      <td><code>agent_template</code></td>
                      <td>Templates for agent creation</td>
                      <td>id, name, description, category, configuration</td>
                    </tr>
                  </tbody>
                </table>
                <p class="mt-3">Each table includes timestamps and proper foreign key relationships. Refer to <code>models.py</code> for the complete schema definition.</p>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header" id="headingManualDb">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseManualDb" aria-expanded="false" aria-controls="collapseManualDb">
                <strong>Manual Database Setup (Optional)</strong>
              </button>
            </h2>
            <div id="collapseManualDb" class="accordion-collapse collapse" aria-labelledby="headingManualDb" data-bs-parent="#databaseAccordion">
              <div class="accordion-body">
                <p>If you prefer to create the database tables manually or need to run SQL scripts directly, here are the core table creation statements:</p>
                <div class="card mb-3 mt-2">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">create_tables.sql</h6>
                  </div>
                  <div class="card-body bg-dark text-white">
                    <pre class="mb-0"><code>-- Conversation table
CREATE TABLE conversation (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(64) NOT NULL,
    user_input TEXT NOT NULL,
    brain_response TEXT NOT NULL,
    intent VARCHAR(64),
    confidence FLOAT,
    selected_agent VARCHAR(64),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_conversation_session_id ON conversation(session_id);

-- Message table
CREATE TABLE message (
    id SERIAL PRIMARY KEY,
    conversation_id INTEGER NOT NULL REFERENCES conversation(id) ON DELETE CASCADE,
    role VARCHAR(32) NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Package Tracking table
CREATE TABLE package_tracking (
    id SERIAL PRIMARY KEY,
    conversation_id INTEGER NOT NULL REFERENCES conversation(id) ON DELETE CASCADE,
    tracking_number VARCHAR(128) NOT NULL,
    shipping_carrier VARCHAR(64),
    order_number VARCHAR(128),
    status VARCHAR(64),
    estimated_delivery VARCHAR(64),
    current_location VARCHAR(128),
    last_updated TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Password Reset table
CREATE TABLE password_reset (
    id SERIAL PRIMARY KEY,
    conversation_id INTEGER NOT NULL REFERENCES conversation(id) ON DELETE CASCADE,
    email VARCHAR(128),
    username VARCHAR(128),
    account_type VARCHAR(64),
    issue VARCHAR(128),
    reset_link_sent BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Store Locator table
CREATE TABLE store_locator (
    id SERIAL PRIMARY KEY,
    conversation_id INTEGER NOT NULL REFERENCES conversation(id) ON DELETE CASCADE,
    location VARCHAR(128),
    radius INTEGER DEFAULT 10,
    service VARCHAR(128),
    store_id VARCHAR(64),
    store_name VARCHAR(128),
    store_address VARCHAR(256),
    store_phone VARCHAR(64),
    store_hours TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Product Info table
CREATE TABLE product_info (
    id SERIAL PRIMARY KEY,
    conversation_id INTEGER NOT NULL REFERENCES conversation(id) ON DELETE CASCADE,
    product_name VARCHAR(256),
    product_id VARCHAR(128),
    category VARCHAR(128),
    price VARCHAR(64),
    availability VARCHAR(64),
    description TEXT,
    specifications TEXT,
    search_query VARCHAR(256),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Other tables including agent configurations and templates have been omitted for brevity</code></pre>
                  </div>
                </div>
                <div class="alert alert-warning">
                  <i class="bi bi-exclamation-triangle"></i> If you manually create tables, the SQLAlchemy ORM will not attempt to create them again, but you must ensure your schema matches exactly what's defined in <code>models.py</code>.
                </div>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header" id="headingTestData">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTestData" aria-expanded="false" aria-controls="collapseTestData">
                <strong>Sample & Test Data</strong>
              </button>
            </h2>
            <div id="collapseTestData" class="accordion-collapse collapse" aria-labelledby="headingTestData" data-bs-parent="#databaseAccordion">
              <div class="accordion-body">
                <p>For testing purposes, you can insert sample data into your database. Here are scripts to create some test entries:</p>
                
                <div class="card mb-3">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">sample_data.sql</h6>
                  </div>
                  <div class="card-body bg-dark text-white">
                    <pre class="mb-0"><code>-- Insert sample conversations
INSERT INTO conversation (session_id, user_input, brain_response, intent, confidence, selected_agent, created_at)
VALUES
  ('test-session-1', 'Where is my order #ST12345?', 'I''ll help you track your order. The package is currently in transit and expected to be delivered tomorrow.', 'track_package', 0.92, 'Package Tracking Agent', NOW() - INTERVAL '2 hours'),
  ('test-session-2', 'I need to reset my password', 'I can help you reset your password. Could you please provide the email address associated with your account?', 'reset_password', 0.88, 'Reset Password Agent', NOW() - INTERVAL '1 day'),
  ('test-session-3', 'Where is the nearest Staples store?', 'I can help find the nearest Staples store. Could you please share your location or zip code?', 'find_store', 0.95, 'Store Locator Agent', NOW() - INTERVAL '3 days');

-- Insert sample messages for the first conversation
INSERT INTO message (conversation_id, role, content, created_at)
VALUES
  (1, 'user', 'Where is my order #ST12345?', NOW() - INTERVAL '2 hours 5 minutes'),
  (1, 'assistant', 'I''ll help you track your order. Could you confirm the order number is ST12345?', NOW() - INTERVAL '2 hours 4 minutes'),
  (1, 'user', 'Yes, that''s correct', NOW() - INTERVAL '2 hours 3 minutes'),
  (1, 'assistant', 'Thank you. The package is currently in transit and expected to be delivered tomorrow.', NOW() - INTERVAL '2 hours 2 minutes');

-- Insert sample package tracking data
INSERT INTO package_tracking (conversation_id, tracking_number, shipping_carrier, order_number, status, estimated_delivery, current_location, last_updated, created_at)
VALUES
  (1, '1Z999AA10123456784', 'UPS', 'ST12345', 'In Transit', '2025-04-10', 'Distribution Center, Atlanta, GA', NOW() - INTERVAL '6 hours', NOW() - INTERVAL '2 hours');

-- Insert sample store locator data
INSERT INTO store_locator (conversation_id, location, radius, service, store_id, store_name, store_address, store_phone, created_at)
VALUES
  (3, '30308', 10, 'Copy & Print', 'STR-123', 'Staples Atlanta Midtown', '1230 Peachtree St NE, Atlanta, GA 30308', '(404) 555-1234', NOW() - INTERVAL '3 days');

-- Insert sample password reset data
INSERT INTO password_reset (conversation_id, email, account_type, issue, reset_link_sent, created_at)
VALUES
  (2, 'user@example.com', 'customer', 'forgotten password', TRUE, NOW() - INTERVAL '1 day');</code></pre>
                  </div>
                </div>
                
                <div class="alert alert-info">
                  <i class="bi bi-info-circle"></i> You can run these queries in psql or using the PostgreSQL GUI tool of your choice after creating the database tables.
                </div>
                
                <h6 class="mt-3">Generate Test Data with Python</h6>
                <p>Alternatively, you can use a Python script to generate larger amounts of test data:</p>
                
                <div class="card mb-3">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">generate_test_data.py</h6>
                  </div>
                  <div class="card-body bg-dark text-white">
                    <pre class="mb-0"><code>import os
import random
from datetime import datetime, timedelta
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from models import Conversation, Message, PackageTracking, StoreLocator, PasswordReset

# Connect to database
DATABASE_URL = os.environ.get('DATABASE_URL', 'postgresql://staples_user:your_secure_password@localhost/staples_brain')
engine = create_engine(DATABASE_URL)
Session = sessionmaker(bind=engine)
session = Session()

# Generate random dates within the last month
def random_date(days=30):
    return datetime.now() - timedelta(days=random.randint(0, days))

# Create sample intents and responses
intents = [
    {"name": "track_package", "agent": "Package Tracking Agent"},
    {"name": "reset_password", "agent": "Reset Password Agent"},
    {"name": "find_store", "agent": "Store Locator Agent"},
    {"name": "product_info", "agent": "Product Info Agent"}
]

# Generate 20 sample conversations
for i in range(20):
    intent = random.choice(intents)
    conv = Conversation(
        session_id=f"test-session-{i+100}",
        user_input=f"This is test input {i+1}",
        brain_response=f"This is test response {i+1}",
        intent=intent["name"],
        confidence=random.uniform(0.7, 0.98),
        selected_agent=intent["agent"],
        created_at=random_date()
    )
    session.add(conv)
    
    # Add messages for each conversation
    for j in range(random.randint(2, 5)):
        msg = Message(
            conversation=conv,
            role="user" if j % 2 == 0 else "assistant",
            content=f"Sample message {j+1} for conversation {i+1}",
            created_at=random_date()
        )
        session.add(msg)
    
    # Add agent-specific data for some conversations
    if intent["name"] == "track_package":
        tracking = PackageTracking(
            conversation=conv,
            tracking_number=f"1Z{random.randint(10000000, 99999999)}",
            shipping_carrier=random.choice(["UPS", "FedEx", "USPS"]),
            order_number=f"ST{random.randint(10000, 99999)}",
            status=random.choice(["Delivered", "In Transit", "Out for Delivery", "Delayed"]),
            created_at=random_date()
        )
        session.add(tracking)
    
    elif intent["name"] == "find_store":
        store = StoreLocator(
            conversation=conv,
            location=f"{random.randint(10000, 99999)}",
            radius=random.choice([5, 10, 15, 20]),
            service=random.choice(["Copy & Print", "Tech Services", "None"]),
            created_at=random_date()
        )
        session.add(store)

# Commit changes
session.commit()
print(f"Generated test data: 20 conversations with related messages and agent data")</code></pre>
                  </div>
                </div>
                
                <div class="alert alert-warning">
                  <i class="bi bi-exclamation-triangle"></i> Always use test data in development environments only, never in production.
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingDbMaintenance">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDbMaintenance" aria-expanded="false" aria-controls="collapseDbMaintenance">
                <strong>Database Maintenance</strong>
              </button>
            </h2>
            <div id="collapseDbMaintenance" class="accordion-collapse collapse" aria-labelledby="headingDbMaintenance" data-bs-parent="#databaseAccordion">
              <div class="accordion-body">
                <p>For ongoing database maintenance, here are some useful queries and operations:</p>
                <h6 class="mt-3">Backup and Restore</h6>
                <div class="card mb-3">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">Terminal Commands</h6>
                  </div>
                  <div class="card-body bg-dark text-white">
                    <pre class="mb-0"><code># Create a database backup
pg_dump -U staples_user -d staples_brain -F c -f staples_brain_backup.dump

# Restore from backup
pg_restore -U staples_user -d staples_brain -c staples_brain_backup.dump</code></pre>
                  </div>
                </div>
                <h6 class="mt-3">Database Cleanup</h6>
                <div class="card mb-3">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">SQL Queries</h6>
                  </div>
                  <div class="card-body bg-dark text-white">
                    <pre class="mb-0"><code>-- Delete old conversations (older than 30 days)
DELETE FROM conversation 
WHERE created_at < CURRENT_TIMESTAMP - INTERVAL '30 days';

-- Clear all data (for testing environments)
TRUNCATE TABLE conversation CASCADE;

-- Optimize database
VACUUM ANALYZE;</code></pre>
                  </div>
                </div>
                <h6 class="mt-3">Performance Monitoring</h6>
                <div class="card mb-3">
                  <div class="card-header bg-dark text-white">
                    <h6 class="mb-0">SQL Queries</h6>
                  </div>
                  <div class="card-body bg-dark text-white">
                    <pre class="mb-0"><code>-- Check table sizes
SELECT
  table_name,
  pg_size_pretty(pg_total_relation_size(quote_ident(table_name))),
  pg_total_relation_size(quote_ident(table_name))
FROM
  information_schema.tables
WHERE
  table_schema = 'public'
ORDER BY
  pg_total_relation_size(quote_ident(table_name)) DESC;

-- Check slow queries
SELECT query, calls, total_time, mean_time
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;</code></pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="alert alert-success">
          <i class="bi bi-lightbulb"></i> <strong>Tip:</strong> For the SESSION_SECRET, use a strong random string. You can generate one with Python:
          <pre><code>python -c "import secrets; print(secrets.token_hex(16))"</code></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- API Keys Configuration Section -->
  <div class="row mb-5" id="api-keys">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">5. API Keys Configuration</h2>
      
      <div class="mt-4">
        <p>Staples Brain requires several API keys to function properly. Add these to your <code>.env</code> file:</p>
        
        <div class="card mb-4">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">.env (additional entries)</h5>
          </div>
          <div class="card-body bg-dark text-white">
            <pre class="mb-0"><code># Required API keys
OPENAI_API_KEY=your_openai_api_key
LANGSMITH_API_KEY=your_langsmith_api_key

# Optional API keys (add if needed)
DATABRICKS_HOST=your_databricks_host
DATABRICKS_TOKEN=your_databricks_token
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=your_twilio_phone_number</code></pre>
          </div>
        </div>
        
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i> <strong>How to get API keys:</strong>
          <ul>
            <li><a href="https://platform.openai.com/api-keys" target="_blank">OpenAI API Key</a> - Required for the LLM functionality</li>
            <li><a href="https://smith.langchain.com/" target="_blank">LangSmith API Key</a> - For observability and tracing</li>
            <li><a href="https://www.twilio.com/console" target="_blank">Twilio Credentials</a> - Optional, for SMS notifications</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Running the Application Section -->
  <div class="row mb-5" id="running-app">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">6. Running the Application</h2>
      
      <div class="mt-4">
        <p>Once everything is set up, you can run the application:</p>
        
        <div class="card mb-4">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Terminal</h5>
          </div>
          <div class="card-body bg-dark text-white">
            <pre class="mb-0"><code># Make sure your virtual environment is activated
# Load environment variables (use a tool like python-dotenv or source the .env file)

# For development:
flask run --host=0.0.0.0 --port=5000

# For production (using gunicorn):
gunicorn --bind 0.0.0.0:5000 --reuse-port --reload main:app</code></pre>
          </div>
        </div>
        
        <div class="alert alert-success">
          <i class="bi bi-check-circle"></i> Once running, access the application by opening <a href="http://localhost:5000" target="_blank">http://localhost:5000</a> in your web browser.
        </div>
        
        <div class="card mb-4 border-info">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">First-Time Setup</h5>
          </div>
          <div class="card-body">
            <p>The first time you run the application, the database tables will be automatically created. You can then:</p>
            <ol>
              <li>Access the dashboard to verify everything is working correctly</li>
              <li>Try out the built-in agents like Order Tracking or Store Locator</li>
              <li>Create your own custom agents using the Agent Builder</li>
            </ol>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Troubleshooting Section -->
  <div class="row mb-5" id="troubleshooting">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">7. Troubleshooting</h2>
      
      <div class="mt-4">
        <div class="accordion" id="troubleshootingAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                <strong>Database Connection Issues</strong>
              </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#troubleshootingAccordion">
              <div class="accordion-body">
                <ol>
                  <li>Verify PostgreSQL is running with <code>pg_isready</code> or the equivalent service check for your OS</li>
                  <li>Double-check your database credentials in the <code>.env</code> file</li>
                  <li>Ensure the database and user exist with proper permissions</li>
                  <li>Check if you're able to connect to the database manually with <code>psql</code></li>
                  <li>Inspect the application logs for specific error messages</li>
                </ol>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingTwo">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                <strong>API Key Errors</strong>
              </button>
            </h2>
            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#troubleshootingAccordion">
              <div class="accordion-body">
                <ol>
                  <li>Ensure you've added all required API keys to your <code>.env</code> file</li>
                  <li>Verify your OpenAI API key has sufficient credits and is active</li>
                  <li>For error messages like "API key not found," check that your environment variables are being loaded correctly</li>
                  <li>If using Langsmith, verify your account is active and the API key is correct</li>
                </ol>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingThree">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                <strong>Dependency Issues</strong>
              </button>
            </h2>
            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#troubleshootingAccordion">
              <div class="accordion-body">
                <ol>
                  <li>Try reinstalling dependencies: <code>pip install -r requirements.txt --force-reinstall</code></li>
                  <li>Check for version conflicts with <code>pip check</code></li>
                  <li>Ensure you're using a compatible Python version (3.9+ recommended)</li>
                  <li>If specific packages are causing issues, try installing them individually with explicit versions</li>
                </ol>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingFour">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                <strong>Common Error Messages</strong>
              </button>
            </h2>
            <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#troubleshootingAccordion">
              <div class="accordion-body">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Error</th>
                      <th>Solution</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><code>ModuleNotFoundError: No module named 'x'</code></td>
                      <td>Install the missing package: <code>pip install x</code></td>
                    </tr>
                    <tr>
                      <td><code>OperationalError: could not connect to server</code></td>
                      <td>Check your database connection settings and ensure PostgreSQL is running</td>
                    </tr>
                    <tr>
                      <td><code>AuthenticationError: Incorrect API key provided</code></td>
                      <td>Update your OpenAI API key in the <code>.env</code> file</td>
                    </tr>
                    <tr>
                      <td><code>RuntimeError: Working outside of application context</code></td>
                      <td>Ensure you're running the application properly with Flask's application context</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <div class="alert alert-info mt-4">
          <p><i class="bi bi-lightbulb"></i> <strong>Need more help?</strong></p>
          <p>If you encounter issues not covered here, check the application logs for detailed error messages and consult the official documentation for the relevant components (Flask, SQLAlchemy, LangChain, etc.).</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="row mt-5">
    <div class="col-lg-8 offset-lg-2">
      <div class="border-top pt-4 text-muted">
        <p class="small">Â© 2025 Staples Brain Setup Guide</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Initialize tooltips
  document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        
        document.querySelector(this.getAttribute('href')).scrollIntoView({
          behavior: 'smooth'
        });
      });
    });
  });
</script>
{% endblock %}