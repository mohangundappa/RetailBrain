{% extends "base.html" %}

{% block title %}Staples Brain Documentation{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row mb-5">
    <div class="col-lg-8 offset-lg-2">
      <h1 class="mb-4">Staples Brain: User Documentation</h1>
      <p class="lead text-muted">Your comprehensive guide to building intelligent AI agents with Staples' Customer Engagement platform</p>
    </div>
  </div>

  <!-- Table of Contents -->
  <div class="row mb-5">
    <div class="col-lg-8 offset-lg-2">
      <div class="card bg-light">
        <div class="card-body">
          <h5 class="card-title">Table of Contents</h5>
          <ul class="list-unstyled">
            <li><a href="#intro" class="text-decoration-none">Introduction to Staples Brain</a></li>
            <li><a href="#getting-started" class="text-decoration-none">Getting Started</a></li>
            <li><a href="#agent-ecosystem" class="text-decoration-none">The Agent Ecosystem</a></li>
            <li><a href="#wizard" class="text-decoration-none">The Agent Configuration Wizard</a></li>
            <li><a href="#entity-collection" class="text-decoration-none">Entity Collection Framework</a></li>
            <li><a href="#agent-management" class="text-decoration-none">Agent Management</a></li>
            <li><a href="#templates" class="text-decoration-none">Templates Library</a></li>
            <li><a href="#advanced" class="text-decoration-none">Advanced Concepts</a></li>
            <li><a href="#api-docs" class="text-decoration-none">API Documentation</a></li>
            <li><a href="/agent-diagrams" class="text-decoration-none" target="_blank">Agent Architecture Diagrams</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Introduction Section -->
  <div class="row mb-5" id="intro">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">Introduction to Staples Brain</h2>
      
      <div class="mt-4">
        <h4>What is Staples Brain?</h4>
        <p>Staples Brain is a powerful Super Agent platform for Customer Engagement, designed to enhance the customer experience across Staples' Sales and Services channels. It creates intelligent assistants that understand exactly what your customers need, working together under one unified intelligence framework.</p>
        
        <div class="card mb-4 border-0 bg-light">
          <div class="card-body">
            <h5 class="text-primary"><i class="bi bi-lightbulb"></i> The Staples Customer Engagement Vision</h5>
            <p>Think of Staples Brain as your comprehensive customer service ecosystem. The system houses specialized agents with unique capabilities – from tracking orders to providing product information, processing returns, and locating stores. Our orchestration layer connects these agents to provide a seamless, integrated customer experience.</p>
          </div>
        </div>
        
        <h5>Double-Click: What makes it special?</h5>
        <ul>
          <li><strong>Intelligent Orchestration:</strong> Our system efficiently determines which specialized agent should handle a specific customer inquiry</li>
          <li><strong>Entity Collection Framework:</strong> Agents collect specific pieces of information in a consistent, methodical way to provide accurate responses</li>
          <li><strong>Agent Builder:</strong> Create new AI assistants easily with our intuitive wizard interface to address specific customer needs</li>
        </ul>
        
        <h5>Triple-Click: The Technical Foundation</h5>
        <p>For those interested in the technical implementation, Staples Brain is built on:</p>
        <ul>
          <li><strong>LangChain & LangGraph:</strong> Providing the framework for sophisticated agent interactions</li>
          <li><strong>OpenAI Integration:</strong> Powering our natural language understanding capabilities</li>
          <li><strong>PostgreSQL:</strong> Storing conversations and configuration data in a structured database</li>
          <li><strong>LangSmith Telemetry:</strong> Monitoring agent behaviors for continuous improvement</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Getting Started Section -->
  <div class="row mb-5" id="getting-started">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">Getting Started: Your First Steps</h2>
      
      <div class="mt-4">
        <p>If you're new to Staples Brain, we've made it easy to get started with our customer engagement platform. Here's your quick start guide:</p>
        
        <div class="card mb-4 border-primary">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Step 1: Explore the Home Dashboard</h5>
          </div>
          <div class="card-body">
            <p>The home dashboard is your central hub for all Staples Brain activities. From here, you can:</p>
            <ul>
              <li>Test out existing agents by asking questions</li>
              <li>View recent customer conversations</li>
              <li>Access the agent builder</li>
              <li>Navigate to the template gallery</li>
            </ul>
            <img src="https://placeholder.pics/svg/800x400/DEDEDE/555555/Dashboard%20Preview" class="img-fluid rounded mb-3" alt="Dashboard Preview">
            <p><strong>Try this:</strong> Ask "Can you track my package?" to see the Order Tracking agent in action.</p>
          </div>
        </div>
        
        <div class="card mb-4 border-success">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">Step 2: Launch the Agent Builder</h5>
          </div>
          <div class="card-body">
            <p>Ready to create your first agent? Click the "Build New Agent" button to begin. This starts the process of creating a specialized customer engagement tool.</p>
            <p>The Agent Builder will walk you through creating a custom agent step by step - we'll cover this process in detail later.</p>
          </div>
        </div>
        
        <h5>Double-Click: Navigation Basics</h5>
        <p>The Staples Brain navigation is intuitive and straightforward:</p>
        <ul>
          <li><strong>Header Navigation:</strong> Contains links to the main sections: Home, Agent Builder, Templates, and Dashboard</li>
          <li><strong>Breadcrumbs:</strong> Show your current location in the system for easy backtracking</li>
          <li><strong>Agent List:</strong> Available from the dashboard, shows all currently active agents</li>
        </ul>
        
        <h5>Triple-Click: API Endpoints</h5>
        <p>For engineers wanting to integrate with Staples Brain, we offer these API endpoints:</p>
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Endpoint</th>
                <th>Description</th>
                <th>Method</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>/api/process</code></td>
                <td>Process a user request through the main brain</td>
                <td>POST</td>
              </tr>
              <tr>
                <td><code>/api/track-package</code></td>
                <td>Directly access the package tracking agent</td>
                <td>POST</td>
              </tr>
              <tr>
                <td><code>/api/reset-password</code></td>
                <td>Directly access the password reset agent</td>
                <td>POST</td>
              </tr>
              <tr>
                <td><code>/api/agents</code></td>
                <td>List all available agents</td>
                <td>GET</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- The Agent Ecosystem Section -->
  <div class="row mb-5" id="agent-ecosystem">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">The Agent Ecosystem</h2>
      
      <div class="mt-4">
        <p>Agents are specialized components within the Staples Brain customer engagement platform. Each agent has a specific role, function, and expertise designed to handle different customer service scenarios.</p>
        
        <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
          <div class="col">
            <div class="card h-100 border-info">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">Order Tracking Agent</h5>
              </div>
              <div class="card-body">
                <p>Helps customers track their packages and orders, providing status updates and estimated delivery dates.</p>
                <p><strong>Key Entities:</strong> tracking_number, order_number, shipping_carrier</p>
                <p><strong>Example:</strong> "Where is my order #ST12345?"</p>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="card h-100 border-danger">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">Reset Password Agent</h5>
              </div>
              <div class="card-body">
                <p>Assists users with password reset processes, guiding them through verification and reset steps.</p>
                <p><strong>Key Entities:</strong> email, username, account_type</p>
                <p><strong>Example:</strong> "I need to reset my account password"</p>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="card h-100 border-success">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">Store Locator Agent</h5>
              </div>
              <div class="card-body">
                <p>Helps customers find nearby store locations, hours, and available services.</p>
                <p><strong>Key Entities:</strong> location, radius, service</p>
                <p><strong>Example:</strong> "Where's the closest Staples store to Brooklyn?"</p>
              </div>
            </div>
          </div>
          
          <div class="col">
            <div class="card h-100 border-warning">
              <div class="card-header bg-warning text-white">
                <h5 class="mb-0">Product Information Agent</h5>
              </div>
              <div class="card-body">
                <p>Provides detailed information about products, specifications, pricing, and availability.</p>
                <p><strong>Key Entities:</strong> product_name, product_id, category</p>
                <p><strong>Example:</strong> "Tell me about the HP OfficeJet Pro 9015"</p>
              </div>
            </div>
          </div>
        </div>
        
        <h5>Double-Click: How Agents Work</h5>
        <p>Each agent in our system follows a consistent workflow:</p>
        <ol>
          <li><strong>Intent Identification:</strong> The brain first identifies what the customer is trying to accomplish</li>
          <li><strong>Entity Collection:</strong> The agent systematically gathers required information to process the request</li>
          <li><strong>Processing:</strong> The agent uses the collected entities to perform its specialized function</li>
          <li><strong>Response Generation:</strong> The agent crafts a helpful, contextual response based on its findings</li>
          <li><strong>Storage:</strong> The conversation is saved for analytics and future reference</li>
        </ol>
        
        <h5>Triple-Click: Agent Architecture</h5>
        <p>For technical team members, here's the detailed architecture:</p>
        <div class="card bg-dark text-light mb-4">
          <div class="card-body">
            <pre class="mb-0"><code>class BaseAgent:
    """Foundation for all specialized agents"""
    
    def extract_entities(self, user_input):
        """Extract required information from user input"""
        # Uses LLM-based entity extraction with validation
        
    def collect_entities(self, conversation):
        """Interactive process to gather all required entities"""
        # Asks follow-up questions until all requirements met
        
    def process(self, entities):
        """Specialized processing based on agent type"""
        # Each agent implements this differently
        
    def format_response(self, result):
        """Format the response according to templates"""
        # Uses Jinja-style response formatting</code></pre>
          </div>
        </div>
        <p>All specialized agents inherit from the BaseAgent class, maintaining a consistent structure while implementing specific business logic relevant to their function.</p>
      </div>
    </div>
  </div>

  <!-- The Agent Wizard Journey Section -->
  <div class="row mb-5" id="wizard">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">The Agent Configuration Wizard</h2>
      
      <div class="mt-4">
        <p>Creating a new agent is a straightforward process with our intuitive configuration wizard. The wizard guides you through five logical steps to build a specialized customer service agent:</p>
        
        <div class="accordion mb-4" id="wizardAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                <strong>Step 1: Agent Basics</strong>
              </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#wizardAccordion">
              <div class="accordion-body">
                <p>Start by giving your agent a clear identity that reflects its purpose:</p>
                <ul>
                  <li><strong>Name:</strong> Choose a descriptive name for your agent</li>
                  <li><strong>Description:</strong> Explain what your agent does</li>
                  <li><strong>Icon:</strong> Select a visual representation</li>
                  <li><strong>Active Status:</strong> Decide if the agent should be immediately available</li>
                </ul>
                <div class="alert alert-info">
                  <strong>Pro Tip:</strong> Choose a name that clearly indicates the agent's purpose, like "Order Return Agent" or "Product Recommendation Agent."
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingTwo">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                <strong>Step 2: Entity Setup</strong>
              </button>
            </h2>
            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#wizardAccordion">
              <div class="accordion-body">
                <p>Define what specific information your agent needs to collect from customers to fulfill their requests:</p>
                <ul>
                  <li><strong>Entity Name:</strong> What piece of information to collect (e.g., "tracking_number")</li>
                  <li><strong>Description:</strong> What this entity represents</li>
                  <li><strong>Validation Pattern:</strong> Regular expression to validate input (e.g., <code>\d{10}</code> for a 10-digit number)</li>
                  <li><strong>Error Message:</strong> What to tell users when validation fails</li>
                  <li><strong>Examples:</strong> Sample values to help the AI understand what to look for</li>
                </ul>
                <div class="alert alert-info">
                  <strong>Pro Tip:</strong> Use the "Add Entity" button to create multiple entities. For a return processing agent, you might need order_number, return_reason, and item_condition.
                </div>
                <p><strong>Save as Template:</strong> Starting from Step 2, you can save your work as a template for future use by clicking the "Save as Template" button in the navigation.</p>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingThree">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                <strong>Step 3: Prompts</strong>
              </button>
            </h2>
            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#wizardAccordion">
              <div class="accordion-body">
                <p>Configure how your agent thinks and communicates with customers:</p>
                <ul>
                  <li><strong>System Prompt:</strong> The core instructions that define your agent's personality and capabilities</li>
                  <li><strong>Entity Extraction Prompt:</strong> Instructions for finding entities in user messages</li>
                  <li><strong>Response Generation Prompt:</strong> Guidelines for crafting helpful responses</li>
                </ul>
                <div class="alert alert-info">
                  <strong>Pro Tip:</strong> Use the pre-built prompt templates as starting points. Click buttons like "Customer Service" or "Order Tracking" to load specialized templates.
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingFour">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                <strong>Step 4: Response Format</strong>
              </button>
            </h2>
            <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#wizardAccordion">
              <div class="accordion-body">
                <p>Specify how responses to customers should be structured for clarity and consistency:</p>
                <ul>
                  <li><strong>Response Schema:</strong> The JSON structure with fields your agent should generate (e.g., tracking_status, estimated_delivery)</li>
                  <li><strong>Output Format Template:</strong> How to present this information to users using Jinja-style templates</li>
                </ul>
                <div class="alert alert-info">
                  <strong>Pro Tip:</strong> Click "Order Tracking" or other suggestion buttons to load pre-built schemas, then customize them for your needs.
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingFive">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                <strong>Step 5: Review & Complete</strong>
              </button>
            </h2>
            <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#wizardAccordion">
              <div class="accordion-body">
                <p>Before finalizing your agent, perform these important quality checks:</p>
                <ul>
                  <li>Confirm your agent configuration is correct</li>
                  <li>Review entity definitions</li>
                  <li>Check prompt templates</li>
                  <li>Verify response formats</li>
                </ul>
                <p>Click "Complete Setup" to finalize your agent and make it available in the system.</p>
                <div class="alert alert-info">
                  <strong>Pro Tip:</strong> After completion, test your agent by asking relevant questions on the home page. If something doesn't work as expected, you can edit the agent configuration later.
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <h5>Double-Click: Navigation Controls</h5>
        <p>The wizard provides these navigation options:</p>
        <ul>
          <li><strong>Previous/Next:</strong> Move between steps</li>
          <li><strong>Save & Continue:</strong> Save your current progress and advance to the next step</li>
          <li><strong>Save as Template:</strong> Available from Step 2 onward, allows you to save your current configuration as a template for future use</li>
          <li><strong>Complete Setup:</strong> In the final step, finishes the agent configuration</li>
        </ul>
        
        <h5>Triple-Click: Behind the Scenes</h5>
        <p>When you complete the wizard, these technical processes occur:</p>
        <ol>
          <li>Your agent configuration is stored in the database as a <code>CustomAgent</code> record</li>
          <li>Entity definitions are stored as JSON in the <code>entity_definitions</code> field</li>
          <li>Prompt templates are saved in the <code>prompt_templates</code> field</li>
          <li>Response formats are saved in the <code>response_formats</code> field</li>
          <li>The agent is registered with the orchestrator for intent matching</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Entity Collection Section -->
  <div class="row mb-5" id="entity-collection">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">Entity Collection Framework</h2>
      
      <div class="mt-4">
        <p>Entities are the essential pieces of information that our agents need to fulfill customer requests. From tracking numbers to email addresses, agents gather and validate these key data points to provide accurate service.</p>
        
        <div class="card mb-4">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">The Entity Collection Process</h5>
          </div>
          <div class="card-body">
            <p>Our system uses a sophisticated approach to gather information from users through a systematic process:</p>
            <ol>
              <li><strong>Initial Extraction:</strong> The system first tries to identify all required entities from the user's initial message</li>
              <li><strong>Follow-up Questions:</strong> If any required entities are missing, the agent asks targeted questions to collect them</li>
              <li><strong>Validation:</strong> Each entity is checked against its validation pattern to ensure accuracy</li>
              <li><strong>Storage:</strong> Once collected, entities are stored for use in processing the request</li>
            </ol>
          </div>
        </div>
        
        <h5>Double-Click: Entity Types and Validation</h5>
        <p>The Staples Brain system works with various types of entities, each with specific validation rules:</p>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Entity Type</th>
                <th>Example</th>
                <th>Validation Pattern</th>
                <th>Purpose</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Tracking Numbers</td>
                <td>1Z999AA10123456784</td>
                <td><code>(1Z[0-9A-Z]{16})|(\d{12,14})</code></td>
                <td>Package tracking</td>
              </tr>
              <tr>
                <td>Email Addresses</td>
                <td>user@example.com</td>
                <td><code>[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}</code></td>
                <td>User identification, reset password</td>
              </tr>
              <tr>
                <td>ZIP Codes</td>
                <td>10001</td>
                <td><code>\d{5}(-\d{4})?</code></td>
                <td>Store location</td>
              </tr>
              <tr>
                <td>Order Numbers</td>
                <td>ST-12345678</td>
                <td><code>ST-\d{8}</code></td>
                <td>Order tracking, returns</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <h5>Triple-Click: The Collection Algorithm</h5>
        <p>For technical users interested in the underlying mechanics, here's the entity collection algorithm:</p>
        <div class="card bg-dark text-light mb-4">
          <div class="card-body">
            <pre class="mb-0"><code>def collect_entities(self, conversation):
    """
    Interactive entity collection process.
    
    1. Extract entities from initial message
    2. Identify missing required entities
    3. For each missing entity:
       a. Generate follow-up question
       b. Process user response
       c. Validate extracted entity
       d. If valid, add to collected entities
       e. If invalid, provide error and ask again
    4. Continue until all required entities collected
       or max attempts reached
    5. Return collected entities
    """</code></pre>
          </div>
        </div>
        
        <div class="alert alert-warning">
          <h5 class="alert-heading">Common Problems & Solutions</h5>
          <p>Even in the most well-designed systems, issues can arise:</p>
          <ul class="mb-0">
            <li><strong>Entity Not Recognized:</strong> Improve your entity examples and description</li>
            <li><strong>Invalid Format Responses:</strong> Refine your validation patterns and error messages</li>
            <li><strong>Endless Follow-up Loops:</strong> Check if your validation pattern is too strict</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Agent Management Section -->
  <div class="row mb-5" id="agent-management">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">Agent Management</h2>
      
      <div class="mt-4">
        <p>Staples Brain provides a comprehensive interface for managing your custom agents. This section explains how to effectively organize, edit, and maintain your agent ecosystem.</p>
        
        <div class="card mb-4 border-0 bg-light">
          <div class="card-body">
            <h5 class="text-primary"><i class="bi bi-gear"></i> Managing Your Agents</h5>
            <p>The Agent Management interface in the Agent Builder allows you to view, edit, and delete all agents in your system. This centralized management console helps you maintain an organized collection of specialized agents.</p>
          </div>
        </div>
        
        <h5>Types of Agents in Staples Brain</h5>
        <p>Staples Brain supports two types of agents that are displayed in the Agent Management interface:</p>
        
        <div class="row mb-4 mt-3">
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Built-in Specialized Agents <span class="badge bg-light text-dark ms-2">System</span></h5>
              </div>
              <div class="card-body">
                <p>These agents are defined in the system's code and offer specialized functionality:</p>
                <ul>
                  <li><strong>Package Tracking Agent</strong></li>
                  <li><strong>Reset Password Agent</strong></li>
                  <li><strong>Store Locator Agent</strong></li>
                  <li><strong>Product Information Agent</strong></li>
                </ul>
                <p>Built-in agents appear with a <span class="badge bg-secondary">Built-in</span> label and can only be viewed, not edited through the interface.</p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Custom Agents <span class="badge bg-light text-dark ms-2">User-Created</span></h5>
              </div>
              <div class="card-body">
                <p>These agents are created through the Agent Builder interface:</p>
                <ul>
                  <li>Created from scratch with custom components</li>
                  <li>Based on templates from the Template Gallery</li>
                  <li>Can be fully customized with unique logic</li>
                  <li>Stored in the database for easy management</li>
                </ul>
                <p>Custom agents can be edited, tested, and deleted through the interface.</p>
              </div>
            </div>
          </div>
        </div>
        
        <h5>Accessing Agent Management</h5>
        <p>You can access the agent management features in the Agent Builder section of Staples Brain:</p>
        <ol>
          <li>Navigate to the Agent Builder from the main navigation</li>
          <li>The "Manage Existing Agents" panel appears at the top of the page</li>
          <li>Click "Show/Hide Agents" to expand the management interface</li>
          <li>You'll see all agents (both built-in and custom) with appropriate labels</li>
          <li>For detailed instructions, click the "View Documentation" link</li>
        </ol>
        
        <div class="row mt-4 mb-4">
          <div class="col-md-4">
            <div class="card h-100">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Editing Custom Agents</h5>
              </div>
              <div class="card-body">
                <p>The edit functionality allows you to modify custom agents:</p>
                <ul>
                  <li>Click the <button class="btn btn-sm btn-outline-primary"><i class="bi bi-pencil"></i> Edit</button> button next to a custom agent</li>
                  <li>This loads the agent onto the canvas</li>
                  <li>Modify components, connections, or configuration</li>
                  <li>Click "Save Agent" to preserve changes</li>
                </ul>
                <p><strong>Remember:</strong> Changes don't take effect until you save the agent.</p>
              </div>
            </div>
          </div>
          
          <div class="col-md-4">
            <div class="card h-100">
              <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Viewing Built-in Agents</h5>
              </div>
              <div class="card-body">
                <p>To view details about built-in system agents:</p>
                <ul>
                  <li>Click the <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-eye"></i> View</button> button next to a built-in agent</li>
                  <li>A modal dialog displays information about the agent</li>
                  <li>Learn about the agent's purpose and functionality</li>
                  <li>Built-in agents cannot be edited through the UI</li>
                </ul>
                <p><strong>Note:</strong> Built-in agents are identified with a <span class="badge bg-secondary">Built-in</span> label.</p>
              </div>
            </div>
          </div>
          
          <div class="col-md-4">
            <div class="card h-100">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">Deleting Custom Agents</h5>
              </div>
              <div class="card-body">
                <p>To remove a custom agent from your system:</p>
                <ul>
                  <li>Click the <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i> Delete</button> button next to the agent</li>
                  <li>A confirmation dialog appears</li>
                  <li>Confirm deletion by clicking "Delete Agent"</li>
                </ul>
                <div class="alert alert-warning mt-2">
                  <i class="bi bi-exclamation-triangle-fill"></i> <strong>Warning:</strong> Deletion is permanent and cannot be undone.
                </div>
                <p><strong>Note:</strong> Built-in agents cannot be deleted.</p>
              </div>
            </div>
          </div>
        </div>
        
        <h5>Double-Click: Best Practices</h5>
        <p>When managing your agent ecosystem, consider these best practices:</p>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Practice</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Consistent Naming</strong></td>
                <td>Use descriptive, specific names that indicate the agent's purpose</td>
              </tr>
              <tr>
                <td><strong>Regular Testing</strong></td>
                <td>Test agents after editing to ensure changes maintain functionality</td>
              </tr>
              <tr>
                <td><strong>Backup Templates</strong></td>
                <td>Save stable agents as templates before making significant changes</td>
              </tr>
              <tr>
                <td><strong>Documentation</strong></td>
                <td>Add comprehensive descriptions to agents explaining their purpose</td>
              </tr>
              <tr>
                <td><strong>Organizational Review</strong></td>
                <td>Periodically review inactive agents for potential deletion</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <h5>Triple-Click: Agency Governance</h5>
        <p>For large organizations with multiple agent creators, consider implementing these governance practices:</p>
        <ul>
          <li><strong>Approval Workflow:</strong> Establish a review process for new or modified agents</li>
          <li><strong>Creator Attribution:</strong> Include creator information in agent descriptions</li>
          <li><strong>Testing Standards:</strong> Define minimum test coverage requirements</li>
          <li><strong>Usage Metrics:</strong> Regularly review analytics to identify high-value agents</li>
          <li><strong>Archiving Strategy:</strong> Archive rather than delete infrequently used agents</li>
        </ul>
        
        <div class="alert alert-info mt-4">
          <i class="bi bi-lightbulb"></i> <strong>Pro Tip:</strong> For detailed documentation on agent management, visit the <a href="/agent-management-docs" target="_blank" class="alert-link">Agent Management Documentation</a> page.
        </div>
      </div>
    </div>
  </div>

  <!-- Templates Section -->
  <div class="row mb-5" id="templates">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">Templates: Reusable Agent Blueprints</h2>
      
      <div class="mt-4">
        <p>Templates provide ready-made agent configurations that you can use to quickly create new agents based on proven designs, saving time and ensuring consistency.</p>
        
        <div class="card mb-4 border-0 bg-light">
          <div class="card-body">
            <h5 class="text-primary"><i class="bi bi-grid"></i> The Template Gallery</h5>
            <p>The Template Gallery is your library of pre-configured agent designs that you can use as starting points for your own customer service solutions.</p>
            <a href="/template-gallery" class="btn btn-primary">Visit Template Gallery</a>
          </div>
        </div>
        
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-header">
                <h5 class="mb-0">Using Templates</h5>
              </div>
              <div class="card-body">
                <p>Templates provide a quick start for new agent creation:</p>
                <ol>
                  <li>Browse the template gallery</li>
                  <li>Select a template that matches your needs</li>
                  <li>Click "Use Template" to create a new agent</li>
                  <li>Customize the pre-filled configuration</li>
                  <li>Complete the setup process</li>
                </ol>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-header">
                <h5 class="mb-0">Creating Templates</h5>
              </div>
              <div class="card-body">
                <p>Share your best agent designs with your team:</p>
                <ol>
                  <li>Build an agent using the wizard</li>
                  <li>At any step after Step 1, click the "Save as Template" button</li>
                  <li>Enter template details in the modal dialog</li>
                  <li>Click "Save Template" to add it to the gallery</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
        
        <h5>Double-Click: Template Categories</h5>
        <p>Templates are organized into business-relevant categories for easy discovery:</p>
        <ul>
          <li><strong>Customer Service:</strong> Templates for handling customer inquiries and support</li>
          <li><strong>Sales:</strong> Templates focused on product recommendations and sales assistance</li>
          <li><strong>Support:</strong> Templates for technical support and troubleshooting</li>
          <li><strong>Order Tracking:</strong> Templates specialized for order and shipment tracking</li>
          <li><strong>Product Information:</strong> Templates for providing detailed product data</li>
          <li><strong>Custom:</strong> User-created templates that don't fit standard categories</li>
        </ul>
        
        <h5>Triple-Click: Template Storage</h5>
        <p>From a technical perspective, templates are stored in the <code>AgentTemplate</code> model with these key fields:</p>
        <ul>
          <li><code>name</code>: The template name</li>
          <li><code>description</code>: Detailed description of the template's purpose</li>
          <li><code>category</code>: Classification grouping (e.g., 'customer-service')</li>
          <li><code>tags</code>: Comma-separated keywords for searching</li>
          <li><code>configuration</code>: JSON blob with agent configuration</li>
          <li><code>entity_definitions</code>: JSON blob with entity definitions</li>
          <li><code>prompt_templates</code>: JSON blob with prompt templates</li>
          <li><code>response_formats</code>: JSON blob with response format definitions</li>
          <li><code>business_rules</code>: JSON blob with business logic rules</li>
          <li><code>is_featured</code>: Boolean indicating if this is a featured template</li>
          <li><code>is_system</code>: Boolean indicating if this is a system-provided template</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Advanced Concepts Section -->
  <div class="row mb-5" id="advanced">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">Advanced Concepts: The Technical Architecture</h2>
      
      <div class="mt-4">
        <p>For retail technology leaders looking to understand the deeper technical aspects of the Staples Brain platform, here are some advanced concepts:</p>
        
        <div class="accordion mb-4" id="advancedAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingIntent">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIntent" aria-expanded="false" aria-controls="collapseIntent">
                <strong>Intent Handling & Orchestration</strong>
              </button>
            </h2>
            <div id="collapseIntent" class="accordion-collapse collapse" aria-labelledby="headingIntent" data-bs-parent="#advancedAccordion">
              <div class="accordion-body">
                <p>Similar to a retail store's customer service department routing inquiries to the right specialist, our orchestration layer determines which agent should handle a customer request:</p>
                <ol>
                  <li><strong>Intent Detection:</strong> Using advanced LLM techniques to understand customer intent</li>
                  <li><strong>Confidence Scoring:</strong> Each agent is assigned a confidence score for the current request</li>
                  <li><strong>Agent Selection:</strong> The agent with the highest confidence above threshold is selected</li>
                  <li><strong>Contextual Boosting:</strong> Previous conversation context can boost certain agents' scores</li>
                  <li><strong>Fallback Mechanisms:</strong> When no agent meets the threshold, a general response is provided</li>
                </ol>
                <div class="alert alert-info">
                  <p>The intent handler generates a detailed analysis of the customer's request, extracting not just the primary intent but also secondary intents and sentiment.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingTelemetry">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTelemetry" aria-expanded="false" aria-controls="collapseTelemetry">
                <strong>Telemetry & Observability</strong>
              </button>
            </h2>
            <div id="collapseTelemetry" class="accordion-collapse collapse" aria-labelledby="headingTelemetry" data-bs-parent="#advancedAccordion">
              <div class="accordion-body">
                <p>Just as retail businesses monitor sales performance and customer satisfaction metrics, our system tracks agent performance with robust analytics:</p>
                <ul>
                  <li><strong>Request Logging:</strong> All customer inquiries and agent responses are logged for analysis</li>
                  <li><strong>Performance Metrics:</strong> Response times, resolution rates, and confidence scores are tracked</li>
                  <li><strong>LangSmith Integration:</strong> Detailed traces of LLM calls and agent execution for quality assurance</li>
                  <li><strong>Prometheus Integration:</strong> Real-time metrics exposed for enterprise monitoring systems</li>
                  <li><strong>Analytics Dashboard:</strong> Visual representation of agent performance and customer satisfaction</li>
                </ul>
                <p>Visit the Dashboard page to view comprehensive metrics about your agents' performance and identify opportunities for improvement.</p>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingLLM">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLLM" aria-expanded="false" aria-controls="collapseLLM">
                <strong>LLM Integration & Prompt Engineering</strong>
              </button>
            </h2>
            <div id="collapseLLM" class="accordion-collapse collapse" aria-labelledby="headingLLM" data-bs-parent="#advancedAccordion">
              <div class="accordion-body">
                <p>Similar to training retail staff to provide consistent customer service, prompt engineering is crucial for agent performance:</p>
                <ul>
                  <li><strong>System Prompts:</strong> Define the agent's personality and capabilities like a customer service training manual</li>
                  <li><strong>Few-Shot Learning:</strong> Providing examples helps the LLM understand patterns, like showing a new employee examples of good responses</li>
                  <li><strong>Chain-of-Thought:</strong> Guiding the LLM through logical reasoning steps, similar to a decision tree for handling customer inquiries</li>
                  <li><strong>Output Formatting:</strong> Ensuring consistent, branded responses that align with Staples' voice and tone</li>
                </ul>
                <div class="card bg-light mb-3">
                  <div class="card-body">
                    <h6 class="card-title">Prompt Template Variables</h6>
                    <p class="card-text">These variables are available in prompt templates:</p>
                    <ul class="mb-0">
                      <li><code>{user_input}</code>: The user's message</li>
                      <li><code>{entity_list}</code>: List of entities to extract</li>
                      <li><code>{conversation_history}</code>: Previous messages</li>
                      <li><code>{extracted_entities}</code>: Entities already extracted</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingIntegration">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIntegration" aria-expanded="false" aria-controls="collapseIntegration">
                <strong>External Integrations</strong>
              </button>
            </h2>
            <div id="collapseIntegration" class="accordion-collapse collapse" aria-labelledby="headingIntegration" data-bs-parent="#advancedAccordion">
              <div class="accordion-body">
                <p>Just as retail stores connect with various suppliers and service providers, our platform connects with external enterprise services:</p>
                <ul>
                  <li><strong>Kore.ai:</strong> Integration with external conversational platforms for omnichannel customer engagement</li>
                  <li><strong>Salesforce:</strong> Connecting to customer data and service systems for comprehensive customer profiles</li>
                  <li><strong>Databricks:</strong> Advanced analytics and data processing for business intelligence</li>
                  <li><strong>Twilio:</strong> SMS notification capabilities for order updates and promotional messages</li>
                </ul>
                <p>Integration points are available through our API endpoints, allowing enterprise systems to invoke specific agents or the entire orchestration layer as part of your retail technology ecosystem.</p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card border-primary mb-4">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Future Horizons: What's Coming Next</h5>
          </div>
          <div class="card-body">
            <p>Just as retail continues to evolve with new technologies and customer expectations, we're developing new capabilities for the Staples Brain platform:</p>
            <div class="row">
              <div class="col-md-6">
                <ul>
                  <li><strong>Visual Flow Designer:</strong> Graphical interface for designing complex customer journeys</li>
                  <li><strong>Collaborative Features:</strong> Team-based agent development across departments</li>
                  <li><strong>Advanced Entity Validation:</strong> Context-aware validation for order numbers and product information</li>
                  <li><strong>Integration Marketplace:</strong> Pre-built connections to retail systems and platforms</li>
                </ul>
              </div>
              <div class="col-md-6">
                <ul>
                  <li><strong>Hierarchical Entities:</strong> Product categories and order details with complex relationships</li>
                  <li><strong>A/B Testing:</strong> Compare different agent configurations to optimize customer satisfaction</li>
                  <li><strong>Learning Improvements:</strong> Agents that learn from successful customer interactions</li>
                  <li><strong>Multi-modal Support:</strong> Handling product images and other visual customer inputs</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="row mt-5">
    <div class="col-lg-8 offset-lg-2">
      <div class="border-top pt-4 text-muted">
        <p>"Good customer service doesn't just solve problems—it creates lasting connections. With Staples Brain, we're making every interaction an opportunity to deliver exceptional service." - Staples Customer Experience Team</p>
        <p class="small">© 2025 Staples Brain Documentation</p>
      </div>
    </div>
  </div>

  <!-- API Documentation Section -->
  <div class="row mb-5" id="api-docs">
    <div class="col-lg-8 offset-lg-2">
      <h2 class="border-bottom pb-2">API Documentation</h2>
      
      <div class="mt-4">
        <p>Staples Brain provides a comprehensive RESTful API for integration with other systems. You can use these endpoints to programmatically interact with our brain and specialized agents.</p>
        
        <div class="endpoint mb-4">
          <div class="card bg-dark text-light">
            <div class="card-header d-flex align-items-center">
              <span class="badge bg-primary me-2">POST</span>
              <span class="fw-bold">/api/process</span>
            </div>
            <div class="card-body">
              <p>Process a natural language request using the most appropriate agent.</p>
              <h6 class="mt-3">Request Body:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "input": "Track my package with tracking number TRACK123456",
  "context": {
    "user_id": "12345",
    "session_id": "abcdef"
  }
}</code></pre>
              <h6 class="mt-3">Response:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "agent": "Package Tracking Agent",
  "response": "Your package with tracking number TRACK123456 is currently in transit...",
  "tracking_info": { ... },
  "package_status": { ... },
  "success": true,
  "selected_agent": "Package Tracking Agent",
  "confidence": 0.95
}</code></pre>
            </div>
          </div>
        </div>
        
        <div class="endpoint mb-4">
          <div class="card bg-dark text-light">
            <div class="card-header d-flex align-items-center">
              <span class="badge bg-primary me-2">POST</span>
              <span class="fw-bold">/api/track-package</span>
            </div>
            <div class="card-body">
              <p>Directly access the package tracking agent.</p>
              <h6 class="mt-3">Request Body:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "tracking_number": "TRACK123456"
}</code></pre>
              <h6 class="mt-3">Or:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "query": "Where is my package that I ordered last week?"
}</code></pre>
            </div>
          </div>
        </div>
        
        <div class="endpoint mb-4">
          <div class="card bg-dark text-light">
            <div class="card-header d-flex align-items-center">
              <span class="badge bg-primary me-2">POST</span>
              <span class="fw-bold">/api/reset-password</span>
            </div>
            <div class="card-body">
              <p>Directly access the password reset agent.</p>
              <h6 class="mt-3">Request Body:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "email": "user@example.com"
}</code></pre>
              <h6 class="mt-3">Or:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "query": "I forgot my password and need to reset it"
}</code></pre>
            </div>
          </div>
        </div>
        
        <div class="endpoint mb-4">
          <div class="card bg-dark text-light">
            <div class="card-header d-flex align-items-center">
              <span class="badge bg-success me-2">GET</span>
              <span class="fw-bold">/api/agents</span>
            </div>
            <div class="card-body">
              <p>List all available agents.</p>
              <h6 class="mt-3">Response:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "success": true,
  "agents": [
    "Package Tracking Agent",
    "Reset Password Agent",
    "Store Locator Agent",
    "Product Information Agent",
    "Returns Processing Agent"
  ]
}</code></pre>
            </div>
          </div>
        </div>
        
        <div class="endpoint mb-4">
          <div class="card bg-dark text-light">
            <div class="card-header d-flex align-items-center">
              <span class="badge bg-success me-2">GET</span>
              <span class="fw-bold">/api/health</span>
            </div>
            <div class="card-body">
              <p>Check the health status of the Staples Brain.</p>
              <h6 class="mt-3">Response:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "status": "healthy",
  "message": "Staples Brain is running",
  "version": "1.0.0",
  "agents": [
    "Package Tracking Agent",
    "Reset Password Agent",
    "Store Locator Agent",
    "Product Information Agent",
    "Returns Processing Agent"
  ]
}</code></pre>
            </div>
          </div>
        </div>
        
        <div class="endpoint mb-4">
          <div class="card bg-dark text-light">
            <div class="card-header d-flex align-items-center">
              <span class="badge bg-primary me-2">POST</span>
              <span class="fw-bold">/api/generate-entity-definitions</span>
            </div>
            <div class="card-body">
              <p>Generate entity definitions code for the entity collection framework.</p>
              <h6 class="mt-3">Request Body:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "entities": [
    {
      "name": "order_number",
      "required": true,
      "validation_pattern": "^[A-Za-z0-9]{2,}-?[A-Za-z0-9]{2,}$",
      "error_message": "Order numbers typically contain letters and numbers",
      "description": "Your Staples order number",
      "examples": ["OD1234567", "STB-987654"]
    }
  ]
}</code></pre>
              <h6 class="mt-3">Response:</h6>
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "success": true,
  "code": "def collect_order_number(...):\n    ...",
  "entity_definitions": { ... }
}</code></pre>
            </div>
          </div>
        </div>
        
        <h5>Using API Authentication</h5>
        <p>For production use, all API endpoints require authentication. Requests should include an Authorization header with a valid API key:</p>
        <pre class="bg-dark text-light p-3 rounded"><code>Authorization: Bearer YOUR_API_KEY</code></pre>
        
        <h5>API Rate Limits</h5>
        <p>The Staples Brain API enforces the following rate limits to ensure system stability:</p>
        <ul>
          <li>100 requests per minute for standard endpoints</li>
          <li>30 requests per minute for high-computation endpoints (e.g., process, generate-entity-definitions)</li>
        </ul>
        <p>Rate limit headers are included in all responses to help you track your usage.</p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Initialize tooltips
  document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        
        document.querySelector(this.getAttribute('href')).scrollIntoView({
          behavior: 'smooth'
        });
      });
    });
  });
</script>
{% endblock %}