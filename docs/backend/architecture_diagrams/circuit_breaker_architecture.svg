<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="900" height="700" viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect x="0" y="0" width="900" height="700" fill="#f8f9fa" rx="10" ry="10"/>
  
  <!-- Title -->
  <text x="450" y="40" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">Circuit Breaker Architecture - Technical Details</text>
  
  <!-- Module Boxes -->
  <!-- Core Circuit Breaker Module -->
  <rect x="50" y="90" width="350" height="200" fill="#e9ecef" stroke="#343a40" stroke-width="2" rx="5" ry="5"/>
  <text x="225" y="115" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">utils/circuit_breaker.py</text>
  
  <rect x="70" y="130" width="150" height="140" fill="#007bff" stroke="#0056b3" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="145" y="150" font-family="Arial" font-size="14" text-anchor="middle" fill="white" font-weight="bold">CircuitBreaker</text>
  <text x="145" y="175" font-family="Arial" font-size="10" text-anchor="middle" fill="white">name: str</text>
  <text x="145" y="195" font-family="Arial" font-size="10" text-anchor="middle" fill="white">failure_threshold: int</text>
  <text x="145" y="215" font-family="Arial" font-size="10" text-anchor="middle" fill="white">recovery_timeout: int</text>
  <text x="145" y="235" font-family="Arial" font-size="10" text-anchor="middle" fill="white">state: str</text>
  <text x="145" y="255" font-family="Arial" font-size="10" text-anchor="middle" fill="white">execute(func, fallback)</text>
  
  <rect x="230" y="130" width="150" height="140" fill="#6f42c1" stroke="#4e2a84" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="305" y="150" font-family="Arial" font-size="14" text-anchor="middle" fill="white" font-weight="bold">CircuitBreakerRegistry</text>
  <text x="305" y="175" font-family="Arial" font-size="10" text-anchor="middle" fill="white">_circuit_breakers: dict</text>
  <text x="305" y="195" font-family="Arial" font-size="10" text-anchor="middle" fill="white">register(cb)</text>
  <text x="305" y="215" font-family="Arial" font-size="10" text-anchor="middle" fill="white">get(name)</text>
  <text x="305" y="235" font-family="Arial" font-size="10" text-anchor="middle" fill="white">reset(name)</text>
  <text x="305" y="255" font-family="Arial" font-size="10" text-anchor="middle" fill="white">get_all_circuit_states()</text>
  
  <!-- API Client Integration -->
  <rect x="450" y="90" width="400" height="200" fill="#e9ecef" stroke="#343a40" stroke-width="2" rx="5" ry="5"/>
  <text x="650" y="115" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">api_services/base_api_client.py</text>
  
  <rect x="470" y="130" width="360" height="140" fill="#28a745" stroke="#1e7e34" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="650" y="150" font-family="Arial" font-size="14" text-anchor="middle" fill="white" font-weight="bold">StaplesApiClient</text>
  <text x="650" y="175" font-family="Arial" font-size="10" text-anchor="middle" fill="white">service_name: str</text>
  <text x="650" y="195" font-family="Arial" font-size="10" text-anchor="middle" fill="white">mock_mode: bool</text>
  <text x="650" y="215" font-family="Arial" font-size="10" text-anchor="middle" fill="white">failure_threshold: int</text>
  <text x="650" y="235" font-family="Arial" font-size="10" text-anchor="middle" fill="white">recovery_timeout: int</text>
  <text x="650" y="255" font-family="Arial" font-size="10" text-anchor="middle" fill="white">_make_request(method, endpoint, params, data, mock_response)</text>
  
  <!-- Circuit Breaker API -->
  <rect x="50" y="330" width="350" height="200" fill="#e9ecef" stroke="#343a40" stroke-width="2" rx="5" ry="5"/>
  <text x="225" y="355" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">api/circuit_breaker.py</text>
  
  <rect x="70" y="370" width="310" height="140" fill="#fd7e14" stroke="#c96500" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="225" y="390" font-family="Arial" font-size="14" text-anchor="middle" fill="white" font-weight="bold">circuit_breaker_api Blueprint</text>
  <text x="225" y="415" font-family="Arial" font-size="10" text-anchor="middle" fill="white">GET /api/circuit-breakers</text>
  <text x="225" y="435" font-family="Arial" font-size="10" text-anchor="middle" fill="white">GET /api/circuit-breakers/{name}</text>
  <text x="225" y="455" font-family="Arial" font-size="10" text-anchor="middle" fill="white">POST /api/circuit-breakers/{name}/reset</text>
  <text x="225" y="475" font-family="Arial" font-size="10" text-anchor="middle" fill="white">(JSON responses with circuit breaker states)</text>
  
  <!-- Concrete API Clients -->
  <rect x="450" y="330" width="400" height="200" fill="#e9ecef" stroke="#343a40" stroke-width="2" rx="5" ry="5"/>
  <text x="650" y="355" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">API Client Implementations</text>
  
  <rect x="470" y="370" width="175" height="140" fill="#20c997" stroke="#13795b" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="557.5" y="390" font-family="Arial" font-size="14" text-anchor="middle" fill="white" font-weight="bold">OrderApiClient</text>
  <text x="557.5" y="415" font-family="Arial" font-size="10" text-anchor="middle" fill="white">service_name="order-api"</text>
  <text x="557.5" y="435" font-family="Arial" font-size="10" text-anchor="middle" fill="white">get_order_by_id()</text>
  <text x="557.5" y="455" font-family="Arial" font-size="10" text-anchor="middle" fill="white">get_order_shipment_status()</text>
  <text x="557.5" y="475" font-family="Arial" font-size="10" text-anchor="middle" fill="white">(Protected by circuit breaker)</text>
  
  <rect x="655" y="370" width="175" height="140" fill="#20c997" stroke="#13795b" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="742.5" y="390" font-family="Arial" font-size="14" text-anchor="middle" fill="white" font-weight="bold">StoreApiClient</text>
  <text x="742.5" y="415" font-family="Arial" font-size="10" text-anchor="middle" fill="white">service_name="store-api"</text>
  <text x="742.5" y="435" font-family="Arial" font-size="10" text-anchor="middle" fill="white">get_store_by_id()</text>
  <text x="742.5" y="455" font-family="Arial" font-size="10" text-anchor="middle" fill="white">find_stores_by_location()</text>
  <text x="742.5" y="475" font-family="Arial" font-size="10" text-anchor="middle" fill="white">(Protected by circuit breaker)</text>
  
  <!-- External Services -->
  <rect x="250" y="570" width="400" height="80" fill="#e9ecef" stroke="#343a40" stroke-width="2" rx="5" ry="5"/>
  <text x="450" y="595" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">External Services</text>
  
  <rect x="270" y="605" width="160" height="30" fill="#dc3545" stroke="#a71d2a" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="350" y="625" font-family="Arial" font-size="12" text-anchor="middle" fill="white">Staples Order API</text>
  
  <rect x="470" y="605" width="160" height="30" fill="#dc3545" stroke="#a71d2a" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="550" y="625" font-family="Arial" font-size="12" text-anchor="middle" fill="white">Staples Store API</text>
  
  <!-- Connections -->
  <!-- CircuitBreaker to CircuitBreakerRegistry -->
  <path d="M 220 200 L 230 200" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="225" y="190" font-family="Arial" font-size="10" text-anchor="middle">manages</text>
  
  <!-- CircuitBreakerRegistry to API -->
  <path d="M 225 330 L 225 270" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="200" y="300" font-family="Arial" font-size="10" text-anchor="start">queries</text>
  
  <!-- CircuitBreaker to Base API Client -->
  <path d="M 400 180 L 470 180" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="435" y="170" font-family="Arial" font-size="10" text-anchor="middle">protects</text>
  
  <!-- Base API Client to Concrete Clients -->
  <path d="M 650 270 L 650 330" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="670" y="300" font-family="Arial" font-size="10" text-anchor="start">extends</text>
  
  <!-- OrderApiClient to Order API -->
  <path d="M 557.5 510 L 350 605" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="450" y="550" font-family="Arial" font-size="10" text-anchor="middle">calls</text>
  
  <!-- StoreApiClient to Store API -->
  <path d="M 742.5 510 L 550 605" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="650" y="550" font-family="Arial" font-size="10" text-anchor="middle">calls</text>
  
  <!-- Arrow Marker -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#343a40"/>
    </marker>
  </defs>
  
  <!-- Flow Explanation -->
  <text x="450" y="680" font-family="Arial" font-size="14" text-anchor="middle" font-weight="bold">Implementation Flow:</text>
  <text x="450" y="700" font-family="Arial" font-size="12" text-anchor="middle">API Client -> Circuit Breaker Protection -> External Service -> Fallback Mechanism (if service fails)</text>
</svg>