<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="600" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect x="0" y="0" width="800" height="600" fill="#f8f9fa" rx="10" ry="10"/>
  
  <!-- Title -->
  <text x="400" y="40" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">Circuit Breaker State Transition Diagram</text>
  
  <!-- States and Transitions -->
  
  <!-- Initial State -->
  <circle cx="400" cy="100" r="15" fill="#343a40"/>
  <path d="M 400 115 L 400 150" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="420" y="135" font-family="Arial" font-size="12" text-anchor="start">Initialize</text>
  
  <!-- Closed State -->
  <rect x="300" y="150" width="200" height="80" fill="#28a745" stroke="#1e7e34" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="400" y="185" font-family="Arial" font-size="16" text-anchor="middle" fill="white" font-weight="bold">CLOSED</text>
  <text x="400" y="210" font-family="Arial" font-size="12" text-anchor="middle" fill="white">failure_count = 0</text>
  
  <!-- Self-transition on Closed -->
  <path d="M 500 170 C 560 170 560 210 500 210" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="590" y="190" font-family="Arial" font-size="12" text-anchor="start">Service call succeeds</text>
  
  <!-- Closed to Failure Count -->
  <path d="M 400 230 L 400 270" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="420" y="255" font-family="Arial" font-size="12" text-anchor="start">Service call fails</text>
  
  <!-- Failure Count State -->
  <rect x="300" y="270" width="200" height="80" fill="#ffc107" stroke="#d39e00" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="400" y="305" font-family="Arial" font-size="16" text-anchor="middle" fill="#343a40" font-weight="bold">CLOSED (Counting)</text>
  <text x="400" y="330" font-family="Arial" font-size="12" text-anchor="middle" fill="#343a40">0 < failure_count < threshold</text>
  
  <!-- Self-transition on Failure Count -->
  <path d="M 500 290 C 560 290 560 330 500 330" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="590" y="310" font-family="Arial" font-size="12" text-anchor="start">Service call fails (increment)</text>
  
  <!-- Back to Closed -->
  <path d="M 300 290 C 240 290 240 190 300 190" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="180" y="240" font-family="Arial" font-size="12" text-anchor="middle">Service call succeeds</text>
  <text x="180" y="260" font-family="Arial" font-size="12" text-anchor="middle">Reset failure_count = 0</text>
  
  <!-- Failure Count to Open -->
  <path d="M 400 350 L 400 390" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="470" y="370" font-family="Arial" font-size="12" text-anchor="start">failure_count >= threshold</text>
  
  <!-- Open State -->
  <rect x="300" y="390" width="200" height="80" fill="#dc3545" stroke="#a71d2a" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="400" y="425" font-family="Arial" font-size="16" text-anchor="middle" fill="white" font-weight="bold">OPEN</text>
  <text x="400" y="450" font-family="Arial" font-size="12" text-anchor="middle" fill="white">Fast-fail, use fallbacks</text>
  
  <!-- Self-transition on Open -->
  <path d="M 500 410 C 560 410 560 450 500 450" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="590" y="430" font-family="Arial" font-size="12" text-anchor="start">Service call attempted</text>
  <text x="590" y="450" font-family="Arial" font-size="12" text-anchor="start">(timeout not elapsed)</text>
  
  <!-- Open to Half-Open -->
  <path d="M 400 470 L 400 510" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="470" y="490" font-family="Arial" font-size="12" text-anchor="start">recovery_timeout elapsed</text>
  
  <!-- Half-Open State -->
  <rect x="300" y="510" width="200" height="80" fill="#17a2b8" stroke="#138496" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
  <text x="400" y="545" font-family="Arial" font-size="16" text-anchor="middle" fill="white" font-weight="bold">HALF-OPEN</text>
  <text x="400" y="570" font-family="Arial" font-size="12" text-anchor="middle" fill="white">Allow test request</text>
  
  <!-- Half-Open to Closed -->
  <path d="M 300 510 C 150 510 150 190 300 190" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="150" y="400" font-family="Arial" font-size="12" text-anchor="middle">Test request succeeds</text>
  <text x="150" y="420" font-family="Arial" font-size="12" text-anchor="middle">Reset failure_count = 0</text>
  
  <!-- Half-Open to Open -->
  <path d="M 500 510 C 650 510 650 430 500 430" stroke="#343a40" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
  <text x="650" y="480" font-family="Arial" font-size="12" text-anchor="middle">Test request fails</text>
  <text x="650" y="500" font-family="Arial" font-size="12" text-anchor="middle">Reset timeout</text>
  
  <!-- Arrow Marker -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#343a40"/>
    </marker>
  </defs>
  
  <!-- State Legend -->
  <rect x="600" y="110" width="20" height="20" fill="#28a745" opacity="0.8"/>
  <text x="630" y="125" font-family="Arial" font-size="12" text-anchor="start">Closed: Normal operation, all calls allowed</text>
  
  <rect x="600" y="140" width="20" height="20" fill="#ffc107" opacity="0.8"/>
  <text x="630" y="155" font-family="Arial" font-size="12" text-anchor="start">Closed (Counting): Failures occurring but below threshold</text>
  
  <rect x="600" y="170" width="20" height="20" fill="#dc3545" opacity="0.8"/>
  <text x="630" y="185" font-family="Arial" font-size="12" text-anchor="start">Open: Circuit broken, all calls fail fast</text>
  
  <rect x="600" y="200" width="20" height="20" fill="#17a2b8" opacity="0.8"/>
  <text x="630" y="215" font-family="Arial" font-size="12" text-anchor="start">Half-Open: Testing recovery, allowing one call</text>
</svg>